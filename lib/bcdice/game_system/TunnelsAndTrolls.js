(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[5188],{6450:(pe,ve,ee)=>{ee(9993),Opal.queue(function(u){var le,ce,he,o,z,v,L,P,fe,X,Y=[],e=u.nil,ne=u.$$$,J=u.module,re=u.klass,E=u.const_set,te=u.send2,$e=u.find_super,f=u.def,i=u.truthy,m=u.send,F=u.rb_ge,p=u.rb_minus,l=u.rb_plus,ie=u.to_a,w=u.rb_gt,B=u.eqeq,ue=u.neqeq,Q=u.rb_lt,G=u.rb_times,se=u.hash2,U=u.rb_divide,W=u.rb_le;return le=Y,ce=X=[J(Y[0],"BCDice")].concat(le),P=[J(X[0],"GameSystem")].concat(ce),fe=u.$r(P),he=P,z=[o=re(P[0],fe("Base"),"TunnelsAndTrolls")].concat(he),v=u.$r(z),(L=o.$$prototype).dice_total=L.count_6=L.randomizer=L.dice_list=e,E(z[0],"ID","TunnelsAndTrolls"),E(z[0],"NAME","\u30c8\u30f3\u30cd\u30eb\u30ba\uff06\u30c8\u30ed\u30fc\u30eb\u30ba"),E(z[0],"SORT_KEY","\u3068\u3093\u306d\u308b\u3059\u3042\u3093\u3068\u3068\u308d\u304a\u308b\u3059"),E(z[0],"HELP_MESSAGE",'\u30fb\u884c\u70ba\u5224\u5b9a\u3000(nD6+x>=nLV)\n\u5931\u6557\u3001\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3068\u30be\u30ed\u76ee\u306e\u632f\u308a\u8db3\u3057\u7d4c\u9a13\u5024\u306e\u81ea\u52d5\u8a08\u7b97\u3092\u884c\u3044\u307e\u3059\u3002\nSAVE\u306e\u96e3\u6613\u5ea6\u3092\u300c\u30ec\u30d9\u30eb\u300d\u3067\u8868\u8a18\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u300c2Lv\u300d\u3068\u66f8\u304f\u3068\u300c25\u300d\u306b\u7f6e\u63db\u3055\u308c\u307e\u3059\u3002\n\u5224\u5b9a\u6642\u4ee5\u5916\u306f\u60aa\u610f\u30c0\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u7528\u306b\u5c02\u7528\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u307e\u3059\u3002\n\u4f8b\uff092D6+1>=1Lv\n\u3000 (2D6+1>=20) \uff1e 7[2,5]+1 \uff1e 8 \uff1e \u5931\u6557\n\u3000\u5224\u5b9a\u6642\u306b\u306f\u30be\u30ed\u76ee\u3092\u81ea\u52d5\u3067\u632f\u308a\u8db3\u3057\u307e\u3059\u3002\n\n\u30fb\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3000(nBS+x or nHBS+x)\n\u3000"(\u30c0\u30a4\u30b9\u6570)BS(\u4fee\u6b63\u5024)"\u3067\u30d0\u30fc\u30b5\u30fc\u30af\u3001"(\u30c0\u30a4\u30b9\u6570)HBS(\u4fee\u6b63\u5024)"\u3067\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3067\u30ed\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\u3000\u6700\u521d\u306e\u30c0\u30a4\u30b9\u306e\u8aad\u66ff\u306f\u3001\u500b\u5225\u306e\u51fa\u76ee\u306f\u305d\u306e\u307e\u307e\u3067\u8868\u793a\u3002\n\u3000\u4e0b\u304b\u3089\uff12\u756a\u76ee\u306e\u51fa\u76ee\u3092\u305a\u3089\u3057\u305f\u5206\u3060\u3051\u5408\u8a08\u306b\u30de\u30a4\u30ca\u30b9\u4fee\u6b63\u3092\u8ffd\u52a0\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n'),o.$register_prefix("\\d+H?BS","\\d+R6","\\d+D\\d+"),f(o,"$initialize",function _(n){var r=this;return delete _.$$p,te(r,$e(r,"initialize",_,!1,!0),"initialize",[n],null),r.sort_add_dice=!0},1),o.$private(),f(o,"$replace_text",function(n){return i(/BS/i["$=~"](n))&&(n=m(n,"gsub",[/(\d+)HBS([^\d\s][+\-\d]+)/i],function(){return v("Regexp").$last_match(1)+"R6"+v("Regexp").$last_match(2)+"[H]"},0),n=m(n,"gsub",[/(\d+)HBS/i],function(){return v("Regexp").$last_match(1)+"R6[H]"},0),n=m(n,"gsub",[/(\d+)BS([^\d\s][+\-\d]+)/i],function(){return v("Regexp").$last_match(1)+"R6"+v("Regexp").$last_match(2)},0),n=m(n,"gsub",[/(\d+)BS/i],function(){return v("Regexp").$last_match(1)+"R6"},0)),n},1),f(o,"$eval_game_system_specific_command",function(n){var t=this,r=e,$=e,b=e,a=e,h=e,c=e,y=e,d=e,I=e,R=e,k=e,K=e;return i(/^\d+D\d+/i["$match?"](n))?t.$roll_action(n):(n=t.$replace_text(n),t.$debug("tandt_berserk string",n),r="1",i($=/(^|\s)S?((\d+)[rR]6([+\-\d]*)(\[(\w+)\])?)(\s|$)/i.$match(n))&&(t.$debug("tandt_berserk matched"),n=$["$[]"](2),b=$["$[]"](3).$to_i(),a=0,i($["$[]"](4))&&(a=v("ArithmeticEvaluator").$eval($["$[]"](4))),h=!1,i($["$[]"](5))&&i($["$[]"](6)["$=~"](/[Hh]/))&&(h=!0),c=[],y=0,d="",I=!0,R=0,k=0,t.$debug("isHyperBerserk",h),c.$push(b),function(){var N=u.new_brk();try{m(t,"loop",[],function g(){var j,Z,x=null==g.$$s?this:g.$$s,T=e,C=e,O=e,M=e,S=e,H=e,D=e;if(null==x.randomizer&&(x.randomizer=e),x.$debug("loop dice_arr",c),j=c.$shift(),x.$debug("roll dice_wk d6",j),Z=(T=x.randomizer.$roll_barabara(j,6).$sort()).$sum(),C=T.$count(6),i(F(j,2))&&(O=T,S=[],m(M=6,"times",[],function(s){return null==s&&(s=e),S.$push(0)},1),m(O,"each",[],function(s){var q;return null==s&&(s=e),q=[p(s,1),l(S["$[]"](p(s,1)),1)],m(S,"[]=",ie(q)),q[p(q.length,1)]},1),m(S,"each",[],function(s){return null==s&&(s=e),i(F(s,2))?(i(h)&&(s=l(s,1)),c.$push(s)):e},1),i(I)&&i(c["$empty?"]())&&(H=0,D=0,m(M,"times",[],function A(s){var V,q=null==A.$$s?this:A.$$s;return null==s&&(s=e),V=p(p(M,s),1),q.$debug("diceType index",V),i(w(S["$[]"](V),0))?(D=H,H=V):e},{$$arity:1,$$s:x}),x.$debug("min1, min2",H,D),k=p(D,H)["$-@"](),B(D,5)&&(C=p(C,1)),i(h)?c.$push(3):c.$push(2))),y=l(y,Z),ue(d,"")&&(d=l(d,"][")),d=l(d,T.$join(",")),R=l(R,C),I=!1,x.$debug("loop last chek dice_arr",c),!i(c["$empty?"]()))return e;u.brk(e,N)},{$$arity:0,$$s:t,$$brk:N})}catch(g){if(g===N)return g.$v;throw g}}(),t.$debug("loop breaked"),t.$debug("dice_now, bonus, bonus2",y,a,k),K=l(l(y,a),k),r=y+(d="["+d+"]"),i(Q(k,0))&&(t.$debug("bonus2",k),r=l(r,k.$to_s())),t.$debug("bonus",a),i(w(a,0))?r=l(r,"+"+a):i(Q(a,0))&&(r=l(r,a.$to_s())),r=i(r["$=~"](/[^\d\[\]]+/))?"("+n+") \uff1e "+r+" \uff1e "+K:"("+n+") \uff1e "+K,i(w(R,0))&&(r=l(r," \uff1e \u60aa\u610f"+R))),r)},1),f(o,"$roll_action",function(n){var t=this,$=e,b=e,a=e,h=e;return n=m(n,"sub",[/\d+LV$/i],function(d){return null==d&&(d=e),l(G(d.$to_i(),5),15)},1),$=ne(v("Command"),"Parser").$new(/\d+D6/,se(["round_type"],{round_type:t.$round_type()})).$restrict_cmp_op_to(e,">=").$enable_question_target().$parse(n),i($)?(b=$.$command().$to_i(),t.$roll_action_dice(b),a=l(t.dice_total,$.$modify_number()),h=i($["$question_target?"]())?"?":$.$target_number(),["("+$+")",t.$interim_expr($,t.dice_total),a.$to_s(),t.$action_result(a,t.dice_total,h),t.$additional_result(t.count_6)].$compact().$join(" \uff1e ")):e},1),f(o,"$roll_action_dice",function(n){var r=this,$=e,b=e;for($=r.randomizer.$roll_barabara(n,6).$sort(),r.dice_list=[$];i(r["$same_all_dice?"]($));)$=r.randomizer.$roll_barabara(n,6).$sort(),r.dice_list.$push($);return b=r.dice_list.$flatten(),r.dice_total=b.$sum(),r.count_6=b.$count(6)},1),f(o,"$same_all_dice?",function(n){var t;return i(t=w(n.$size(),1))?n.$uniq().$size()["$=="](1):t},1),f(o,"$interim_expr",function(n,t){var $=e,b=e;return B(this.dice_list.$flatten().$size(),1)&&B(n.$modify_number(),0)?e:($=m(this.dice_list,"map",[],function(h){return null==h&&(h=e),"["+h.$join(",")+"]"},1).$join(""),b=v("Format").$modifier(n.$modify_number()),[t.$to_s(),$,b].$join(""))},2),f(o,"$action_result",function(n,t,r){return B(t,3)?"\u81ea\u52d5\u5931\u6557":i(r["$nil?"]())?e:B(r,"?")?this.$success_level(n,t):i(F(n,r))?"\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+this.$experience_point(r,t):"\u5931\u6557"},3),f(o,"$success_level",function(n,t){var r;return r=U(p(n,15),5).$to_i(),i(W(r,0))?"\u5931\u6557 \uff1e \u7d4c\u9a13\u5024"+t:r+"Lv\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+t},2),f(o,"$experience_point",function(n,t){var $=e;return $=G(U(G(1,p(n,15)),5),t),i(W($,0))?"0":i(this["$int?"]($))?$.$to_i().$to_s():this.$format("%.1f",$)},2),f(o,"$int?",function(n){return n["$=="](n.$to_i())},1),f(o,"$additional_result",function(n){return i(w(n,0))?"\u60aa\u610f"+n:e},1)})}}]);