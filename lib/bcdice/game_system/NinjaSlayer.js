(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[7381],{517:(de,he,fe)=>{fe(9993),Opal.modules["racc/parser"]=function(t){var L,R,f,u=[],s=t.$r(u),e=t.nil,Y=t.$$$,x=t.module,T=t.klass,a=t.truthy,J=t.const_set,G=t.defs,Q=t.gvars,O=t.rb_lt,B=t.send,W=t.to_a,b=t.rb_minus,F=t.def,ee=t.to_ary,ne=t.neqeq,C=t.rb_plus,i=t.eqeq,c=t.rb_ge,k=t.rb_gt,H=t.eqeqeq,X=t.rb_le,j=t.rb_times;return L=u,R=[x(u[0],"Racc")].concat(L),f=t.$r(R),T(R[0],f("StandardError"),"ParseError"),a(Y("::","ParseError","skip_raise")?"constant":e)||J(u[0],"ParseError",Y(s("Racc"),"ParseError")),function(K,L){var P,h,l,v,g,f=[x(K,"Racc")].concat(L),N=t.$r(f);return a(N("Racc_No_Extensions","skip_raise")?"constant":e)||J(f[0],"Racc_No_Extensions",!1),P=f,l=[h=T(f[0],null,"Parser")].concat(P),v=t.$r(l),(g=h.$$prototype).yydebug=g.racc_debug_out=g.racc_error_status=g.racc_t=g.racc_vstack=g.racc_val=g.racc_state=g.racc_tstack=e,J(l[0],"Racc_Runtime_Version","1.4.6"),J(l[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),J(l[0],"Racc_Runtime_Core_Version_R","1.4.6"),J(l[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),J(l[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),J(l[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),J(l[0],"Racc_Runtime_Core_Version",v("Racc_Runtime_Core_Version_R")),J(l[0],"Racc_Runtime_Core_Revision",v("Racc_Runtime_Core_Revision_R")),J(l[0],"Racc_Runtime_Type","ruby"),G(v("Parser"),"$racc_runtime_type",function(){return v("Racc_Runtime_Type")},0),F(h,"$_racc_setup",function(){var $,y,r=this,E=e,n=e,w=e;return null==Q.stderr&&(Q.stderr=e),a(Y(r.$class(),"Racc_debug_parser"))||(r.yydebug=!1),a(null!=($=r.yydebug)&&$!==e?"instance-variable":e)||(r.yydebug=!1),a(r.yydebug)&&(a(null!=(y=r.racc_debug_out)&&y!==e?"instance-variable":e)||(r.racc_debug_out=Q.stderr),r.racc_debug_out=a(E=r.racc_debug_out)?E:Q.stderr),n=Y(r.$class(),"Racc_arg"),a(O(n.$size(),14))&&(B(n,"[]=",W(w=[13,!0])),b(w.length,1)),n},0),F(h,"$_racc_init_sysvars",function(){var $=this;return $.racc_state=[0],$.racc_tstack=[],$.racc_vstack=[],$.racc_t=e,$.racc_val=e,$.racc_read_next=!0,$.racc_user_yyerror=!1,$.racc_error_status=0},0),F(h,"$do_parse",function(){return this.$__send__(v("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},0),F(h,"$next_token",function(){return this.$raise(v("NotImplementedError"),this.$class()+"#next_token is not defined")},0),F(h,"$_racc_do_parse_rb",function($,y){var r,n=this,w=e,z=e,S=e,D=e,A=e,o=e,I=e,V=e;return r=ee($),w=null==r[0]?e:r[0],z=null==r[1]?e:r[1],S=null==r[2]?e:r[2],D=null==r[3]?e:r[3],A=null==r[10]?e:r[10],n.$_racc_init_sysvars(),o=I=V=e,B(n,"catch",["racc_end_parse"],function M(){var te,ie,U=null==M.$$s?this:M.$$s,se=e;for(null==U.racc_state&&(U.racc_state=e),null==U.racc_read_next&&(U.racc_read_next=e),null==U.racc_t&&(U.racc_t=e),null==U.yydebug&&(U.yydebug=e),null==U.racc_val&&(U.racc_val=e);a(!0);)for(a(V=D["$[]"](U.racc_state["$[]"](-1)))?(a(U.racc_read_next)&&ne(U.racc_t,0)&&(ie=U.$next_token(),te=ee(ie),o=null==te[0]?e:te[0],U.racc_val=null==te[1]?e:te[1],U.racc_t=a(o)?a(se=A["$[]"](o))?se:1:0,a(U.yydebug)&&U.$racc_read_token(U.racc_t,o,U.racc_val),U.racc_read_next=!1),V=C(V,U.racc_t),a(c(V,0))&&a(I=w["$[]"](V))&&i(z["$[]"](V),U.racc_state["$[]"](-1))||(I=S["$[]"](U.racc_state["$[]"](-1)))):I=S["$[]"](U.racc_state["$[]"](-1));a(I=U.$_racc_evalact(I,$)););},{$$arity:0,$$s:n})},2),F(h,"$yyparse",function($,y){return this.$__send__(v("Racc_YY_Parse_Method"),$,y,this.$_racc_setup(),!0)},2),F(h,"$_racc_yyparse_rb",function($,y,r,E){var n,z=this,S=e,D=e,_=e,A=e,I=e,V=e,M=e;return n=ee(r),S=null==n[0]?e:n[0],D=null==n[1]?e:n[1],_=null==n[2]?e:n[2],A=null==n[3]?e:n[3],I=null==n[10]?e:n[10],z.$_racc_init_sysvars(),V=e,M=e,B(z,"catch",["racc_end_parse"],function $e(){var U=null==$e.$$s?this:$e.$$s;for(null==U.racc_state&&(U.racc_state=e);!a(M=A["$[]"](U.racc_state["$[]"](-1)));)for(;a(V=U.$_racc_evalact(_["$[]"](U.racc_state["$[]"](-1)),r)););return B($,"__send__",[y],function se(ae,oe){var re=null==se.$$s?this:se.$$s,_e=e,le=e;for(null==re.racc_t&&(re.racc_t=e),null==re.racc_state&&(re.racc_state=e),null==re.racc_read_next&&(re.racc_read_next=e),null==ae&&(ae=e),null==oe&&(oe=e),re.racc_t=a(ae)?a(_e=I["$[]"](ae))?_e:1:0,re.racc_val=oe,re.racc_read_next=!1,M=C(M,re.racc_t),a(c(M,0))&&a(V=S["$[]"](M))&&i(D["$[]"](M),re.racc_state["$[]"](-1))||(V=_["$[]"](re.racc_state["$[]"](-1)));a(V=re.$_racc_evalact(V,r)););for(;a(a(_e=a(le=(M=A["$[]"](re.racc_state["$[]"](-1)))["$!"]())?le:re.racc_read_next["$!"]())?_e:re.racc_t["$=="](0));)for(a(M)&&a(M=C(M,re.racc_t))&&a(c(M,0))&&a(V=S["$[]"](M))&&i(D["$[]"](M),re.racc_state["$[]"](-1))||(V=_["$[]"](re.racc_state["$[]"](-1)));a(V=re.$_racc_evalact(V,r)););},{$$arity:2,$$s:U})},{$$arity:0,$$s:z})},4),F(h,"$_racc_evalact",function($,y){var r,_,n=this,w=e,z=e,D=e,A=e,o=e,I=e,V=e;if(w=null==(r=ee(y))[0]?e:r[0],z=null==r[1]?e:r[1],D=null==r[3]?e:r[3],_=null==r[11]?e:r[11],A=null==r[12]?e:r[12],a(k($,0))&&a(O($,_)))a(k(n.racc_error_status,0))&&(i(n.racc_t,1)||(n.racc_error_status=b(n.racc_error_status,1))),n.racc_vstack.$push(n.racc_val),n.racc_state.$push($),n.racc_read_next=!0,a(n.yydebug)&&(n.racc_tstack.$push(n.racc_t),n.$racc_shift(n.racc_t,n.racc_tstack,n.racc_vstack));else if(a(O($,0))&&a(k($,A["$-@"]()))){if(o=B(n,"catch",["racc_jump"],function M(){var $e=null==M.$$s?this:M.$$s;return null==$e.racc_state&&($e.racc_state=e),$e.racc_state.$push($e.$_racc_do_reduce(y,$)),!1},{$$arity:0,$$s:n}),a(o)){if(H(1,I=o))return n.racc_user_yyerror=!0,A["$-@"]();if(H(2,I))return _;n.$raise("[Racc Bug] unknown jump code")}}else if(i($,_))a(n.yydebug)&&n.$racc_accept(),n.$throw("racc_end_parse",n.racc_vstack["$[]"](0));else{if(i($,A["$-@"]())){for(H(0,I=n.racc_error_status)?a(y["$[]"](21))||n.$on_error(n.racc_t,n.racc_val,n.racc_vstack):H(3,I)&&(i(n.racc_t,0)&&n.$throw("racc_end_parse",e),n.racc_read_next=!0),n.racc_user_yyerror=!1,n.racc_error_status=3;a(!0)&&!(a(V=D["$[]"](n.racc_state["$[]"](-1)))&&(V=C(V,1),a(c(V,0))&&a($=w["$[]"](V))&&i(z["$[]"](V),n.racc_state["$[]"](-1))));)a(X(n.racc_state.$size(),1))&&n.$throw("racc_end_parse",e),n.racc_state.$pop(),n.racc_vstack.$pop(),a(n.yydebug)&&(n.racc_tstack.$pop(),n.$racc_e_pop(n.racc_state,n.racc_tstack,n.racc_vstack));return $}n.$raise("[Racc Bug] unknown action "+$.$inspect())}return a(n.yydebug)&&n.$racc_next_state(n.racc_state["$[]"](-1),n.racc_state),e},2),F(h,"$_racc_do_reduce",function($,y){var r,A,I,U,se,ae,re,n=this,z=e,S=e,D=e,_=e,o=e,V=e,M=e,$e=e,te=e,ie=e,oe=e,ce=e,ue=e,_e=e;return z=null==(r=ee($))[4]?e:r[4],S=null==r[5]?e:r[5],D=null==r[6]?e:r[6],_=null==r[7]?e:r[7],A=null==r[8]?e:r[8],o=null==r[9]?e:r[9],I=null==r[13]?e:r[13],V=n.racc_state,M=n.racc_vstack,$e=n.racc_tstack,te=j(y,-3),ie=o["$[]"](te),U=o["$[]"](C(te,1)),se=o["$[]"](C(te,2)),ae=[],a(n.yydebug)&&(oe=$e["$[]"](ie["$-@"](),ie)),ce=M["$[]"](ie["$-@"](),ie),a(n.yydebug)&&(ue=[ie["$-@"](),ie,ae],B($e,"[]=",W(ue)),b(ue.length,1)),ue=[ie["$-@"](),ie,ae],B(M,"[]=",W(ue)),b(ue.length,1),ue=[ie["$-@"](),ie,ae],B(V,"[]=",W(ue)),b(ue.length,1),a(I)?M.$push(n.$__send__(se,ce,M,ce["$[]"](0))):M.$push(n.$__send__(se,ce,M)),$e.$push(U),a(n.yydebug)&&n.$racc_reduce(oe,U,$e,M),re=b(U,A),a(te=_["$[]"](re))&&(te=C(te,V["$[]"](-1)),a(c(te,0))&&a(_e=z["$[]"](te))&&i(S["$[]"](te),re))?_e:D["$[]"](re)},2),F(h,"$on_error",function($,y,r){var n,E=this;return E.$raise(v("ParseError"),E.$sprintf("\nparse error on value %s (%s)",y.$inspect(),a(n=E.$token_to_str($))?n:"?"))},3),F(h,"$yyerror",function(){return this.$throw("racc_jump",1)},0),F(h,"$yyaccept",function(){return this.$throw("racc_jump",2)},0),F(h,"$yyerrok",function(){return this.racc_error_status=0},0),F(h,"$racc_read_token",function($,y,r){var E=this;return E.racc_debug_out.$print("read    "),E.racc_debug_out.$print(y.$inspect(),"(",E.$racc_token2str($),") "),E.racc_debug_out.$puts(r.$inspect()),E.racc_debug_out.$puts()},3),F(h,"$racc_shift",function($,y,r){var E=this;return E.racc_debug_out.$puts("shift   "+E.$racc_token2str($)),E.$racc_print_stacks(y,r),E.racc_debug_out.$puts()},3),F(h,"$racc_reduce",function($,y,r,E){var n=this,w=e;return(w=n.racc_debug_out).$print("reduce "),a($["$empty?"]())?w.$print(" <none>"):B($,"each",[],function z(S){return null==S&&(S=e),w.$print(" ",(null==z.$$s?this:z.$$s).$racc_token2str(S))},{$$arity:1,$$s:n}),w.$puts(" --\x3e "+n.$racc_token2str(y)),n.$racc_print_stacks(r,E),n.racc_debug_out.$puts()},4),F(h,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},0),F(h,"$racc_e_pop",function($,y,r){var E=this;return E.racc_debug_out.$puts("error recovering mode: pop token"),E.$racc_print_states($),E.$racc_print_stacks(y,r),E.racc_debug_out.$puts()},3),F(h,"$racc_next_state",function($,y){var r=this;return r.racc_debug_out.$puts("goto    "+$),r.$racc_print_states(y),r.racc_debug_out.$puts()},2),F(h,"$racc_print_stacks",function($,y){var E=e;return(E=this.racc_debug_out).$print("        ["),B($,"each_index",[],function n(w){return null==w&&(w=e),E.$print(" (",(null==n.$$s?this:n.$$s).$racc_token2str($["$[]"](w))," ",y["$[]"](w).$inspect(),")")},{$$arity:1,$$s:this}),E.$puts(" ]")},2),F(h,"$racc_print_states",function($){var r=e;return(r=this.racc_debug_out).$print("        ["),B($,"each",[],function(n){return null==n&&(n=e),r.$print(" ",n)},1),r.$puts(" ]")},1),F(h,"$racc_token2str",function($){var r;return a(r=Y(this.$class(),"Racc_token_to_s_table")["$[]"]($))?r:this.$raise("[Racc Bug] can't convert token "+$+" to string")},1),F(h,"$token_to_str",function($){return Y(this.$class(),"Racc_token_to_s_table")["$[]"]($)},1)}(u[0],u)},Opal.modules.strscan=function(t){var W,b,F,ee,ne,Z=[],u=t.nil,e=t.def,Y=t.truthy,x=t.eqeqeq,T=t.Opal,a=t.send,J=t.to_a,G=t.rb_minus,Q=t.alias;return W=Z,F=[b=(0,t.klass)(Z[0],null,"StringScanner")].concat(W),ee=t.$r(F),(ne=b.$$prototype).pos=ne.string=ne.working=ne.matched=ne.prev_pos=ne.match=u,b.$attr_reader("pos","matched"),e(b,"$initialize",function(i){var c=this;return c.string=i,c.pos=0,c.matched=u,c.working=i,c.match=[]},1),b.$attr_reader("string"),e(b,"$beginning_of_line?",function(){var i=this;return 0===i.pos||"\n"===i.string.charAt(i.pos-1)},0),e(b,"$scan",function(i){var c=this,k=(i=c.$anchor(i)).exec(c.working);return null==k?c.matched=u:"object"==typeof k?(c.prev_pos=c.pos,c.pos+=k[0].length,c.working=c.working.substring(k[0].length),c.matched=k[0],c.match=k,k[0]):"string"==typeof k?(c.pos+=k.length,c.working=c.working.substring(k.length),k):u},1),e(b,"$scan_until",function(i){var c=this;i=c.$anchor(i);for(var X,k=c.pos,H=c.working;;){if(X=i.exec(H),k+=1,H=H.substr(1),null!=X)return c.matched=c.string.substr(c.pos,k-c.pos-1+X[0].length),c.match=X,c.prev_pos=k-1,c.pos=k,c.working=H.substr(X[0].length),c.matched;if(0===H.length)return c.match=[],c.matched=u}},1),e(b,"$[]",function(i){var k;if(Y(this.match["$empty?"]()))return u;x(ee("Symbol"),k=i)?i=i.$to_s():x(ee("String"),k)||(i=T["$coerce_to!"](i,ee("Integer"),"to_int"));var H=this.match;return i<0&&(i+=H.length),i<0||i>=H.length||null==H[i]?u:H[i]},1),e(b,"$check",function(i){var c=this,k=(i=c.$anchor(i)).exec(c.working);return c.matched=null==k?u:k[0]},1),e(b,"$check_until",function(i){var c=this,k=c.prev_pos,H=c.pos,X=c.$scan_until(i);return X!==u&&(c.matched=X.substr(-1),c.working=c.string.substr(H)),c.prev_pos=k,c.pos=H,X},1),e(b,"$peek",function(i){return this.working.substring(0,i)},1),e(b,"$eos?",function(){return 0===this.working.length},0),e(b,"$exist?",function(i){var k=i.exec(this.working);return null==k?u:0==k.index?0:k.index+1},1),e(b,"$skip",function(i){var c=this,k=(i=c.$anchor(i)).exec(c.working);if(null==k)return c.match=[],c.matched=u;var H=k[0],X=H.length;return c.matched=H,c.match=k,c.prev_pos=c.pos,c.pos+=X,c.working=c.working.substring(X),X},1),e(b,"$skip_until",function(i){var k=this.$scan_until(i);return k===u?u:(this.matched=k.substr(-1),k.length)},1),e(b,"$get_byte",function(){var i=this,c=u;return i.pos<i.string.length?(i.prev_pos=i.pos,i.pos+=1,c=i.matched=i.working.substring(0,1),i.working=i.working.substring(1)):i.matched=u,c},0),e(b,"$match?",function(i){var c=this,k=(i=c.$anchor(i)).exec(c.working);return null==k?u:(c.prev_pos=c.pos,k[0].length)},1),e(b,"$pos=",function(i){var c=this;return i<0&&(i+=c.string.$length()),c.pos=i,c.working=c.string.slice(i)},1),e(b,"$matched_size",function(){return this.matched===u?u:this.matched.length},0),e(b,"$post_match",function(){var i=this;return i.matched===u?u:i.string.substr(i.pos)},0),e(b,"$pre_match",function(){var i=this;return i.matched===u?u:i.string.substr(0,i.prev_pos)},0),e(b,"$reset",function(){var i=this;return i.working=i.string,i.matched=u,i.pos=0},0),e(b,"$rest",function(){return this.working},0),e(b,"$rest?",function(){return 0!==this.working.length},0),e(b,"$rest_size",function(){return this.$rest().$size()},0),e(b,"$terminate",function(){var c,i=this;return i.match=u,c=[i.string.$length()],a(i,"pos=",J(c)),c[G(c.length,1)]},0),e(b,"$unscan",function(){var i=this;return i.pos=i.prev_pos,i.prev_pos=u,i.match=u,i},0),Q(b,"bol?","beginning_of_line?"),Q(b,"getch","get_byte"),b.$private(),e(b,"$anchor",function(i){var c=i.toString().match(/\/([^\/]+)$/);return c=c?c[1]:void 0,new RegExp("^(?:"+i.source+")",c)},1)},Opal.modules["bcdice/normalize"]=function(t){var a,O,G,Z=[],u=t.nil,s=t.module,e=t.eqeqeq,Y=t.def,x=t.eqeq;return a=Z,G=[s(Z[0],"BCDice")].concat(a),(O=s(G[0],"Normalize")).$module_function(),Y(O,"$comparison_operator",function(W){var b;return e(/<=|=</,b=W)?"<=":e(/>=|=>/,b)?">=":e(/<>|!=|=!/,b)?"!=":e(/</,b)?"<":e(/>/,b)?">":e(/=/,b)?"==":u},1),Y(O,"$target_number",function(W){return x(W,"?")?W:W.$to_i()},1)},Opal.modules["bcdice/common_command/lexer"]=function(t){var Q,b,i,c,k,H,ee,B,Z=t.top,u=[],s=t.nil,e=t.module,Y=t.klass,x=t.const_set,T=t.hash2,a=t.truthy,J=t.def;return Z.$require("strscan"),Z.$require("bcdice/normalize"),Q=u,b=B=[e(u[0],"BCDice")].concat(Q),i=ee=[e(B[0],"CommonCommand")].concat(b),k=[c=Y(ee[0],null,"Lexer")].concat(i),H=t.$r(k),c.$$prototype.scanner=s,x(k[0],"SYMBOLS",T(["+","-","*","/","(",")","[","]","?","@"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","?":"QUESTION","@":"AT"}).$freeze()),J(c,"$initialize",function(K){var q;return K=a(q=K.$split(" ",2).$first())?q:"",this.scanner=H("StringScanner").$new(K)},1),J(c,"$next_token",function(){var K=this,L=s,q=s,R=s,N=s;return a(K.scanner["$eos?"]())?[!1,"$"]:a(L=K.scanner.$scan(/\d+/))?["NUMBER",L.$to_i()]:a(q=K.scanner.$scan(/[<>!=]+/))?["CMP_OP",H("Normalize").$comparison_operator(q)]:(R=K.scanner.$getch().$upcase(),[a(N=H("SYMBOLS")["$[]"](R))?N:R.$to_sym(),R])},0),J(c,"$source",function(){return this.scanner.$string()},0)},Opal.modules["bcdice/common_command/reroll_dice/node"]=function(t){var C,H,L,N,l,v,g,m,$,p,R,j,c,Z=[],u=t.nil,s=t.module,e=t.klass,Y=t.hash2,x=t.def,T=t.truthy,a=t.send,J=t.rb_lt,G=t.rb_plus,Q=t.rb_gt,O=t.eqeq,B=t.to_a,W=t.rb_minus,b=t.eqeqeq,F=t.rb_le,ee=t.rb_ge;return C=Z,H=c=[s(Z[0],"BCDice")].concat(C),L=j=[s(c[0],"CommonCommand")].concat(H),N=R=[s(j[0],"RerollDice")].concat(L),l=p=[s(R[0],"Node")].concat(N),g=[v=e(p[0],null,"Command")].concat(l),m=t.$r(g),($=v.$$prototype).cmp_op=$.reroll_cmp_op=$.target_number_node=$.reroll_threshold_node=$.notations=$.source=u,x(v,"$initialize",function(r){var E,n,w,z,S,D,_,A=this;if(null==r)r=Y([],{});else if(!r.$$is_hash)throw t.ArgumentError.$new("expected kwargs");if(!t.hasOwnProperty.call(r.$$smap,"secret"))throw t.ArgumentError.$new("missing keyword: secret");if(E=r.$$smap.secret,!t.hasOwnProperty.call(r.$$smap,"notations"))throw t.ArgumentError.$new("missing keyword: notations");if(n=r.$$smap.notations,!t.hasOwnProperty.call(r.$$smap,"source"))throw t.ArgumentError.$new("missing keyword: source");return w=r.$$smap.source,null==(z=r.$$smap.cmp_op)&&(z=u),null==(S=r.$$smap.target_number)&&(S=u),null==(D=r.$$smap.reroll_cmp_op)&&(D=u),null==(_=r.$$smap.reroll_threshold)&&(_=u),A.secret=E,A.notations=n,A.cmp_op=z,A.target_number_node=S,A.reroll_cmp_op=D,A.reroll_threshold_node=_,A.source=w},1),x(v,"$eval",function(r,E){var n,w,S,D,A,I,V,$e,z=this,_=u,o=u,M=u,te=u,ie=u,U=u,se=u,ae=u;return S=r.$round_type(),D=T(_=z.cmp_op)?_:r.$default_cmp_op(),A=T(_=T(o=z.reroll_cmp_op)?o:D)?_:">=",I=T(_=(n=z.target_number_node)===u||null==n?u:a(n,"eval",[S]))?_:r.$default_target_number(),V=T(_=T(o=(w=z.reroll_threshold_node)===u||null==w?u:a(w,"eval",[S]))?o:r.$reroll_dice_reroll_threshold())?_:I,M=m("RerollCondition").$new(A,V),$e=a(z.notations,"map",[],function(ce){return null==ce&&(ce=u),ce.$to_dice(S)},1),T(a($e,"all?",[],function(ce){return null==ce&&(ce=u),M["$valid?"](ce.$sides())},1))?(ie=(te=z.$roll($e,E,M,r["$sort_barabara_dice?"]())).$flatten(),U=te.$take(z.notations.$size()).$flatten().$count(1),se=T(D)?a(ie,"count",[],function(ce){return null==ce&&(ce=u),ce.$send(D,I)},1):0,ae=[z.$expr(S,M,D,I),a(te,"map",[],function(ce){return null==ce&&(ce=u),ce.$join(",")},1).$join(" + "),"\u6210\u529f\u6570"+se,r.$grich_text(U,ie.$size(),se)].$compact(),z.$result_with_text(ae.$join(" \uff1e "))):z.$result_with_text(z.source+" \uff1e \u6761\u4ef6\u304c\u9593\u9055\u3063\u3066\u3044\u307e\u3059\u30022R6>=5 \u3042\u308b\u3044\u306f 2R6[5] \u306e\u3088\u3046\u306b\u632f\u308a\u8db3\u3057\u76ee\u6a19\u5024\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},2),v.$private(),x(v,"$roll",function(r,E,n,w){var S=u,D=u,_=u,A=u,o=u,I=u;for(S=[],D=0;T(T(_=r["$empty?"]()["$!"]())?J(D,m("REROLL_LIMIT")):_);)A=r.$shift(),D=G(D,1),o=A.$roll(E),T(w)&&o["$sort!"](),S.$push(o),I=a(o,"count",[],function(M){return null==M&&(M=u),n["$reroll?"](M)},1),T(Q(I,0))&&r.$push(m("Dice").$new(I,A.$sides()));return S},4),x(v,"$expr",function(r,E,n,w){var S,D,_;return S=a(this.notations,"map",[],function(o){return null==o&&(o=u),o.$to_dice(r)},1).$join("+"),D=O(E.$cmp_op(),n)?"":m("Format").$comparison_operator(E.$cmp_op()),_=m("Format").$comparison_operator(n),"("+S+"["+D+E.$threshold()+"]"+_+w+")"},4),x(v,"$result_with_text",function(r){return a(m("Result").$new(),"tap",[],function n(w){var z=null==n.$$s?this:n.$$s,S=u;return null==z.secret&&(z.secret=u),null==w&&(w=u),a(w,"secret=",B(S=[z.secret])),W(S.length,1),a(w,"text=",B(S=[r])),S[W(S.length,1)]},{$$arity:1,$$s:this})},1),function(P,h){var l=e(P,null,"RerollCondition"),v=l.$$prototype;v.threshold=v.cmp_op=u,l.$attr_reader("cmp_op"),l.$attr_reader("threshold"),x(l,"$initialize",function(m,$){return this.cmp_op=m,this.threshold=$},2),x(l,"$valid?",function(m){var $=this,y=u;return!!T($.threshold)&&(b("<=",y=$.cmp_op)?J($.threshold,m):b("<",y)?F($.threshold,m):b(">=",y)?Q($.threshold,1):b(">",y)?ee($.threshold,1):!b("!=",y)||t.Range.$new(1,m,!1)["$include?"]($.threshold))},1),x(l,"$reroll?",function(m){return m.$send(this.cmp_op,this.threshold)},1)}(p[0]),function(P,h,l){var v=e(P,null,"Notation"),g=[v].concat(l),m=t.$r(g),$=v.$$prototype;$.times=$.sides=u,x(v,"$initialize",function(r,E){return this.times=r,this.sides=E},2),x(v,"$to_dice",function(r){var n,w;return n=this.times.$eval(r),w=this.sides.$eval(r),m("Dice").$new(n,w)},1)}(p[0],0,p),function(P,h){var l=e(P,null,"Dice");return l.$attr_reader("times","sides"),x(l,"$initialize",function(g,m){return this.times=g,this.sides=m},2),x(l,"$roll",function(g){return g.$roll_barabara(this.$times(),this.$sides())},1),x(l,"$to_s",function(){return this.$times()+"R"+this.$sides()},0)}(p[0])},Opal.modules["bcdice/arithmetic/node"]=function(t){var b,C,H,R,f,j,K,c,ee,Z=[],u=t.nil,s=t.$$$,e=t.module,Y=t.klass,x=t.def,T=t.send2,a=t.find_super,J=t.eqeq,G=t.const_set,Q=t.eqeqeq,O=t.rb_divide,B=t.alias;return b=Z,C=ee=[e(Z[0],"BCDice")].concat(b),H=c=[e(ee[0],"Arithmetic")].concat(C),j=[e(c[0],"Node")].concat(H),K=t.$r(j),(f=(R=Y(j[0],null,"BinaryOp")).$$prototype).lhs=f.rhs=f.op=u,x(R,"$initialize",function(d,p,P){var h=this;return h.lhs=d,h.op=p,h.rhs=P},3),x(R,"$eval",function(d){var h,p=this,P=u;return P=p.lhs.$eval(d),h=p.rhs.$eval(d),P.$send(p.op,h)},1),x(R,"$output",function(){var d=this;return""+d.lhs.$output()+d.op+d.rhs.$output()},0),x(R,"$s_exp",function(){var d=this;return"("+d.$op_for_s_exp()+" "+d.lhs.$s_exp()+" "+d.rhs.$s_exp()+")"},0),x(R,"$op_for_s_exp",function(){return this.op},0),function(L,q,R){var f=Y(L,q,"DivideBase"),N=[f].concat(R),d=t.$r(N),p=f.$$prototype;p.lhs=p.rhs=p.op=u,x(f,"$initialize",function P(h,l){return delete P.$$p,T(this,a(this,"initialize",P,!1,!0),"initialize",[h,"/",l],null)},2),x(f,"$eval",function(h){var v,g,l=this;return v=l.lhs.$eval(h),g=l.rhs.$eval(h),J(g,0)&&l.$raise(d("ZeroDivisionError")),l.$divide_and_round(v,g,h)},1),x(f,"$output",function P(){var h=P.$$p||u,l=this;return delete P.$$p,""+T(l,a(l,"output",P,!1,!0),"output",[],h)+l.$rounding_method()},0),f.$private(),x(f,"$rounding_method",function(){return s(this.$class(),"ROUNDING_METHOD")},0),x(f,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()},0),x(f,"$divide_and_round",function(h,l,v){return this.$raise(d("NotImplementedError"))},3)}(j[0],K("BinaryOp"),j),function(L,q,R){var f=Y(L,q,"DivideWithGameSystemDefault"),N=[f].concat(R),d=t.$r(N);G(N[0],"ROUNDING_METHOD",""),f.$private(),x(f,"$divide_and_round",function(P,h,l){var v;return Q(s(d("RoundType"),"CEIL"),v=l)?O(P.$to_f(),h).$ceil():Q(s(d("RoundType"),"ROUND"),v)?O(P.$to_f(),h).$round():O(P,h).$floor()},3)}(j[0],K("DivideBase"),j),function(L,q,R){var f=Y(L,q,"DivideWithCeil"),N=[f].concat(R);G(N[0],"ROUNDING_METHOD","C"),f.$private(),x(f,"$divide_and_round",function(p,P,h){return O(p.$to_f(),P).$ceil()},3)}(j[0],K("DivideBase"),j),function(L,q,R){var f=Y(L,q,"DivideWithRound"),N=[f].concat(R);G(N[0],"ROUNDING_METHOD","R"),f.$private(),x(f,"$divide_and_round",function(p,P,h){return O(p.$to_f(),P).$round()},3)}(j[0],K("DivideBase"),j),function(L,q,R){var f=Y(L,q,"DivideWithFloor"),N=[f].concat(R);G(N[0],"ROUNDING_METHOD","F"),f.$private(),x(f,"$divide_and_round",function(p,P,h){return O(p,P).$to_i()},3)}(j[0],K("DivideBase"),j),function(L,q){var R=Y(L,null,"Negative");R.$$prototype.body=u,x(R,"$initialize",function(d){return this.body=d},1),x(R,"$eval",function(d){return this.body.$eval(d)["$-@"]()},1),x(R,"$output",function(){return"-"+this.body.$output()},0),x(R,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"},0)}(j[0]),function(L,q){var R=Y(L,null,"Parenthesis");R.$$prototype.expr=u,x(R,"$initialize",function(d){return this.expr=d},1),x(R,"$eval",function(d){return this.expr.$eval(d)},1),x(R,"$output",function(){return"("+this.expr.$output()+")"},0),x(R,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"},0)}(j[0]),function(L,q){var R=Y(L,null,"Number");return R.$$prototype.value=u,x(R,"$initialize",function(d){return this.value=d},1),x(R,"$eval",function(d){return this.value},1),x(R,"$output",function(){return this.value.$to_s()},0),B(R,"s_exp","output")}(j[0])},Opal.modules["bcdice/common_command/barabara_dice/parser"]=function(t){var b,C,H,R,p,P,h,l,v,g,m,$,y,n,f,N,d,j,K,c,ee,Z=t.top,u=[],s=t.nil,e=t.$$$,Y=t.module,x=t.klass,T=t.defs,a=t.def,J=t.hash,G=t.const_set,Q=t.hash2,O=t.to_ary,B=t.truthy;return Z.$require("racc/parser.rb"),Z.$require("bcdice/common_command/lexer"),Z.$require("bcdice/common_command/reroll_dice/node"),Z.$require("bcdice/arithmetic/node"),b=u,C=ee=[Y(u[0],"BCDice")].concat(b),H=c=[Y(ee[0],"CommonCommand")].concat(C),j=[Y(c[0],"BarabaraDice")].concat(H),K=t.$r(j),R=j,N=[f=x(j[0],e(K("Racc"),"Parser"),"Parser")].concat(R),d=t.$r(N),f.$$prototype.lexer=s,T(f,"$parse",function(_){return this.$new().$parse(_)},1),a(f,"$parse",function(_){try{return this.lexer=d("Lexer").$new(_),this.$do_parse()}catch(o){if(!t.rescue(o,[d("ParseError")]))throw o;try{return s}finally{t.pop_exception()}}},1),f.$private(),a(f,"$next_token",function(){return this.lexer.$next_token()},0),p=[13,9,3,9,24,25,9,9,9,26,18,19,8,12,8,18,19,8,8,8,9,4,9,38,36,37,39,18,19,18,19,8,9,8,9,27,28,24,25,18,19,18,19,8,9,8,9,27,28,27,28,18,19,18,19,8,10,8,14],P=[5,2,0,8,15,15,13,14,12,15,8,8,2,5,8,12,12,13,14,12,18,1,19,34,34,34,34,18,18,19,19,18,24,19,25,16,16,21,21,24,24,25,25,24,27,25,28,31,31,32,32,27,27,28,28,27,4,28,7],h=[-6,21,-1,s,56,-9,s,55,1,s,s,s,6,4,5,-5,24,s,18,20,s,28,s,s,30,32,s,42,44,s,s,36,38,s,19,s,s,s,s,s],l=[-2,-25,-25,-3,-25,-4,-7,-25,-25,-24,40,-1,-25,-25,-25,-25,-11,-14,-25,-25,-22,-5,-6,-8,-25,-25,-23,-25,-25,-20,-21,-9,-10,-12,-15,-13,-16,-17,-18,-19],v=[7,1,6,15,2,29,30,21,31,32,5,7,23,22,33,34,11,35],g=[7,1,6,5,2,9,9,5,8,8,3,7,7,6,9,9,4,10],m=[s,1,4,8,11,-5,0,-2,-16,-13,-17],$=[s,s,s,s,s,s,s,20,16,17,s],y=[0,0,"racc_error",3,24,"_reduce_1",0,25,"_reduce_2",1,25,"_reduce_3",0,27,"_reduce_4",2,27,"_reduce_5",3,26,"_reduce_6",1,26,"_reduce_7",3,29,"_reduce_8",3,28,"_reduce_9",3,28,"_reduce_10",1,28,"_reduce_none",3,31,"_reduce_12",4,31,"_reduce_13",1,31,"_reduce_none",0,33,"_reduce_15",1,33,"_reduce_16",1,33,"_reduce_17",1,33,"_reduce_18",1,33,"_reduce_19",2,32,"_reduce_20",2,32,"_reduce_21",1,32,"_reduce_none",3,30,"_reduce_23",1,30,"_reduce_24"],n=J(!1,0,"error",1,"NUMBER",2,"B",3,"R",4,"U",5,"C",6,"F",7,"S",8,"PLUS",9,"MINUS",10,"ASTERISK",11,"SLASH",12,"PARENL",13,"PARENR",14,"BRACKETL",15,"BRACKETR",16,"LESS",17,"GREATER",18,"EQUAL",19,"NOT",20,"AT",21,"CMP_OP",22),G(N[0],"Racc_arg",[p,P,l,h,v,g,$,m,23,y,n,40,25,!0]),G(N[0],"Racc_token_to_s_table",["$end","error","NUMBER","B","R","U","C","F","S","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","LESS","GREATER","EQUAL","NOT","AT","CMP_OP","$start","expr","secret","notations","target","add","dice","term","mul","unary","round_type"]),G(N[0],"Racc_debug_parser",!1),a(f,"$_reduce_1",function(_,A,o){return e(d("Node"),"Command").$new(Q(["secret","notations","cmp_op","target_number"],{secret:_["$[]"](0),notations:_["$[]"](1),cmp_op:_["$[]"](2)["$[]"]("cmp_op"),target_number:_["$[]"](2)["$[]"]("target")}))},3),a(f,"$_reduce_2",function(_,A,o){return!1},3),a(f,"$_reduce_3",function(_,A,o){return!0},3),a(f,"$_reduce_4",function(_,A,o){return Q([],{})},3),a(f,"$_reduce_5",function(_,A,o){var I,$e,te;return te=null==(I=O(_))[1]?s:I[1],B($e=null==I[0]?s:I[0])||this.$raise(d("ParseError")),Q(["cmp_op","target"],{cmp_op:$e,target:te})},3),a(f,"$_reduce_6",function(_,A,o){var I=s;return(I=_["$[]"](0)).$push(_["$[]"](2)),I},3),a(f,"$_reduce_7",function(_,A,o){return[_["$[]"](0)]},3),a(f,"$_reduce_8",function(_,A,o){var I,V;return I=_["$[]"](0),V=_["$[]"](2),e(d("Node"),"Notation").$new(I,V)},3),a(f,"$_reduce_9",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"BinaryOp").$new(_["$[]"](0),"+",_["$[]"](2))},3),a(f,"$_reduce_10",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"BinaryOp").$new(_["$[]"](0),"-",_["$[]"](2))},3),a(f,"$_reduce_12",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"BinaryOp").$new(_["$[]"](0),"*",_["$[]"](2))},3),a(f,"$_reduce_13",function(_,A,o){return _["$[]"](3).$new(_["$[]"](0),_["$[]"](2))},3),a(f,"$_reduce_15",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"DivideWithGameSystemDefault")},3),a(f,"$_reduce_16",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"DivideWithCeil")},3),a(f,"$_reduce_17",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"DivideWithCeil")},3),a(f,"$_reduce_18",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"DivideWithRound")},3),a(f,"$_reduce_19",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"DivideWithFloor")},3),a(f,"$_reduce_20",function(_,A,o){return _["$[]"](1)},3),a(f,"$_reduce_21",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"Negative").$new(_["$[]"](1))},3),a(f,"$_reduce_23",function(_,A,o){return _["$[]"](1)},3),a(f,"$_reduce_24",function(_,A,o){return e(e(d("Arithmetic"),"Node"),"Number").$new(_["$[]"](0))},3),a(f,"$_reduce_none",function(_,A,o){return _["$[]"](0)},3)},Opal.modules["bcdice/common_command/barabara_dice"]=function(t){var J,B,ee,i,k,H,ne,C,b,Q,u=[],s=t.nil,e=t.module,Y=t.const_set,x=t.send,T=t.def;return t.top.$require("bcdice/common_command/barabara_dice/parser"),J=u,B=Q=[e(u[0],"BCDice")].concat(J),ee=b=[e(Q[0],"CommonCommand")].concat(B),Y((C=[ne=e(b[0],"BarabaraDice")].concat(ee))[0],"PREFIX_PATTERN",/\d+B\d+/.$freeze()),k=[i=t.get_singleton_class(ne)].concat(C),H=t.$r(k),T(i,"$eval",function(j,K,L){var q;return(q=H("Parser").$parse(j))===s||null==q?s:x(q,"eval",[K,L])},3)},Opal.modules["bcdice/dice_table/table"]=function(t){var Q,b,i,c,k,H,X,ee,B,Z=[],u=t.nil,s=t.module,e=t.klass,Y=t.hash2,x=t.defs,T=t.truthy,a=t.def,J=t.rb_minus;return Q=Z,b=B=[s(Z[0],"BCDice")].concat(Q),i=ee=[s(B[0],"DiceTable")].concat(b),k=[c=e(ee[0],null,"Table")].concat(i),H=t.$r(k),(X=c.$$prototype).times=X.sides=X.name=X.items=u,x(c,"$from_i18n",function(K,L){var R=u;return R=H("I18n").$t(K,Y(["locale"],{locale:L})),this.$new(R["$[]"]("name"),R["$[]"]("type"),R["$[]"]("items"))},2),a(c,"$initialize",function(K,L,q){var R=this,f=u;return R.name=K,R.items=q.$freeze(),f=/(\d+)D(\d+)/i.$match(L),T(f)||R.$raise(H("ArgumentError"),"Unexpected table type: "+L),R.times=f["$[]"](1).$to_i(),R.sides=f["$[]"](2).$to_i()},3),a(c,"$roll",function(K){var q,L=this;return q=K.$roll_sum(L.times,L.sides),L.$choice(q)},1),a(c,"$choice",function(K){var q,L=this;return q=J(K,L.times),H("RollResult").$new(L.name,K,L.items["$[]"](q))},1)},Opal.queue(function(t){var i,X,f,N,d,p,K,L,k,Z=t.top,u=[],s=t.nil,e=t.$$$,Y=t.module,x=t.klass,T=t.const_set,a=t.send2,J=t.find_super,G=t.def,Q=t.regexp,O=t.hash2,B=t.truthy,W=t.eqeqeq,b=t.send,F=t.rb_gt,ee=t.rb_ge,ne=t.rb_plus;return Z.$require("bcdice/common_command/barabara_dice"),Z.$require("bcdice/dice_table/table"),i=u,X=k=[Y(u[0],"BCDice")].concat(i),K=[Y(k[0],"GameSystem")].concat(X),L=t.$r(K),f=K,d=[N=x(K[0],L("Base"),"NinjaSlayer")].concat(f),p=t.$r(d),N.$$prototype.randomizer=s,T(d[0],"ID","NinjaSlayer"),T(d[0],"NAME","\u30cb\u30f3\u30b8\u30e3\u30b9\u30ec\u30a4\u30e4\u30fcTRPG"),T(d[0],"SORT_KEY","\u306b\u3093\u3057\u3084\u3059\u308c\u3044\u3084\u3042RPG"),T(d[0],"HELP_MESSAGE","\u30fb\u901a\u5e38\u5224\u5b9a\u3000NJ\n\u3000NJx[y] or NJx@y or NJx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 \u7701\u7565\u6642\u306fNORMAL(4)\n\u3000\u4f8b:NJ4@H \u96e3\u6613\u5ea6HARD\u3001\u5224\u5b9a\u30c0\u30a4\u30b94\u3067\u5224\u5b9a\n\u30fb\u56de\u907f\u5224\u5b9a\u3000EV\n\u3000EVx[y]/z or EVx@y/z or EVx/z or EVx[y] or EVx@y or EVx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 z=\u653b\u6483\u5074\u306e\u6210\u529f\u6570(\u7701\u7565\u53ef) \u96e3\u6613\u5ea6\u3092\u7701\u7565\u6642\u306fNORMAL(4)\n\u3000\u653b\u6483\u5074\u306e\u6210\u529f\u6570\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30ab\u30a6\u30f3\u30bf\u30fc\u30ab\u30e9\u30c6\u767a\u751f\u6642\u306b\u306f\u8868\u793a\n\u3000\u4f8b:EV5/3 \u96e3\u6613\u5ea6NORMAL(\u7701\u7565\u6642)\u3001\u5224\u5b9a\u30c0\u30a4\u30b95\u3001\u653b\u6483\u5074\u306e\u6210\u529f\u65703\u3067\u5224\u5b9a\n\u30fb\u8fd1\u63a5\u653b\u6483\u3000AT\n\u3000ATx[y] or ATx@y or ATx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 \u7701\u7565\u6642\u306fNORMAL(4) \u30b5\u30c4\u30d0\u30c4\uff01\u767a\u751f\u6642\u306b\u306f\u8868\u793a\n\u3000\u4f8b:AT6[H] \u96e3\u6613\u5ea6HARD,\u5224\u5b9a\u30c0\u30a4\u30b95\u3067\u8fd1\u63a5\u653b\u6483\u306e\u5224\u5b9a\n\u30fb\u30b5\u30c4\u30d0\u30c4\u5224\u5b9a\u3000SB\n\u30fb\u96fb\u5b50\u6226\u3000EL\n\u3000ELx[y] or ELx@y or ELx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 \u7701\u7565\u6642\u306fNORMAL(4)\n\u3000\u4f8b:EL6[H] \u96e3\u6613\u5ea6HARD,\u5224\u5b9a\u30c0\u30a4\u30b95\u3067\u96fb\u5b50\u6226\u306e\u5224\u5b9a\n\n\u30fb\u96e3\u6613\u5ea6\n\u3000KIDS=K,EASY=E,NORMAL=N,HARD=H,ULTRA HARD=UH \u6570\u5b57\u306b\u3082\u5bfe\u5fdc\n"),G(N,"$initialize",function h(l){var g=this;return delete h.$$p,a(g,J(g,"initialize",h,!1,!0),"initialize",[l],null),g.default_cmp_op=">=",g.default_target_number=4},1),T(d[0],"DIFFICULTY_VALUE_RE","UH|[2-6KENH]".$freeze()),T(d[0],"DIFFICULTY_RE",("(\\[("+p("DIFFICULTY_VALUE_RE")+")\\]|@("+p("DIFFICULTY_VALUE_RE")+"))").$freeze()),T(d[0],"NJ_RE",Q(["^(S)?NJ(\\d+)",p("DIFFICULTY_RE"),"?$"],"i").$freeze()),T(d[0],"EV_RE",Q(["^EV(\\d+)",p("DIFFICULTY_RE"),"?(?:/(\\d+))?$"],"i").$freeze()),T(d[0],"AT_RE",Q(["^AT(\\d+)",p("DIFFICULTY_RE"),"?$"],"i").$freeze()),T(d[0],"EL_RE",Q(["^EL(\\d+)",p("DIFFICULTY_RE"),"?$"],"i").$freeze()),T(d[0],"EV",p("Struct").$new("num","difficulty","targetValue")),T(d[0],"AT",p("Struct").$new("num","difficulty")),T(d[0],"EL",p("Struct").$new("num","difficulty")),T(d[0],"DIFFICULTY_SYMBOL_TO_INTEGER",O(["K","E","N","H","UH"],{K:2,E:3,N:4,H:5,UH:6}).$freeze()),G(N,"$change_text",function(l){var g=s,m=s,$=s;return g=p("NJ_RE").$match(l),B(g)?(m=this.$bRollCommand(g["$[]"](2),this.$integerValueOfDifficulty(B($=g["$[]"](4))?$:g["$[]"](5))),""+g["$[]"](1)+m):l},1),G(N,"$eval_game_system_specific_command",function(l){var v=this,g=s,m=s,$=s;return v.$debug("eval_game_system_specific_command begin string",l),B(g=p("TABLES")["$[]"](l))?g.$roll(v.$randomizer()):W(p("EV"),m=$=v.$parse(l))?v.$executeEV($):W(p("AT"),m)?v.$executeAT($):W(p("EL"),m)?v.$executeEL($):s},1),N.$private(),G(N,"$parse",function(l){var g,v=this;return W(p("EV_RE"),g=l)?v.$parseEV(p("Regexp").$last_match()):W(p("AT_RE"),g)?v.$parseAT(p("Regexp").$last_match()):W(p("EL_RE"),g)?v.$parseEL(p("Regexp").$last_match()):s},1),G(N,"$parseEV",function(l){var v,m,$,y,r;return m=l["$[]"](1).$to_i(),$=this.$integerValueOfDifficulty(B(y=l["$[]"](3))?y:l["$[]"](4)),r=(v=l["$[]"](5))===s||null==v?s:b(v,"to_i",[]),p("EV").$new(m,$,r)},1),G(N,"$parseAT",function(l){var g,m,$;return g=l["$[]"](1).$to_i(),m=this.$integerValueOfDifficulty(B($=l["$[]"](3))?$:l["$[]"](4)),p("AT").$new(g,m)},1),G(N,"$parseEL",function(l){var g,m,$;return g=l["$[]"](1).$to_i(),m=this.$integerValueOfDifficulty(B($=l["$[]"](3))?$:l["$[]"](4)),p("EL").$new(g,m)},1),G(N,"$executeEV",function(l){var g,v=this,m=s,$=s;return g=v.$bRollCommand(l.$num(),l.$difficulty()),$=[(m=e(e(p("BCDice"),"CommonCommand"),"BarabaraDice").$eval(g,v,v.randomizer)).$text()],B(l.$targetValue())&&B(F(m.$success_num(),l.$targetValue()))&&$.$push("\u30ab\u30a6\u30f3\u30bf\u30fc\u30ab\u30e9\u30c6!!"),$.$join(" \uff1e ")},1),G(N,"$executeAT",function(l){var g,$,v=this,m=s,y=s;return g=v.$bRollCommand(l.$num(),l.$difficulty()),$=(m=e(e(p("BCDice"),"CommonCommand"),"BarabaraDice").$eval(g,v,v.randomizer)).$last_dice_list().$count(6),y=[m.$text()],B(ee($,2))&&y.$push("\u30b5\u30c4\u30d0\u30c4!!"),y.$join(" \uff1e ")},1),G(N,"$executeEL",function(l){var g,y,r,v=this,m=s,$=s;return g=v.$bRollCommand(l.$num(),l.$difficulty()),y=($=(m=e(e(p("BCDice"),"CommonCommand"),"BarabaraDice").$eval(g,v,v.randomizer)).$last_dice_list()).$count(6),r=b($,"count",[],function(n){return null==n&&(n=s),ee(n,l.$difficulty())},1),B(ee(y,1))?[m.$text()+" + "+y,ne(r,y)].$join(" \uff1e "):m.$text()},1),G(N,"$integerValueOfDifficulty",function(l){return B(l)?B(/^[2-6]$/.$match(l))?l.$to_i():p("DIFFICULTY_SYMBOL_TO_INTEGER").$fetch(l.$upcase()):4},1),G(N,"$bRollCommand",function(l,v){return l+"B6>="+v},2),T(d[0],"SATSUBATSU_TABLE",["\u300c\u6b7b\u306d\u30fc\u30c3\uff01\u300d\u8179\u90e8\u306b\u5f37\u70c8\u306a\u4e00\u6483\uff01\u3000\u6575\u306f\u304f\u306e\u5b57\u306b\u6298\u308c\u66f2\u304c\u308a\u3001\u30ef\u30a4\u30e4\u30fc\u30a2\u30af\u30b7\u30e7\u30f3\u3081\u3044\u3066\u5439\u3063\u98db\u3093\u3060\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8+1\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u6575\u306f\u5f8c\u65b9\u306e\u58c1\u307e\u305f\u306f\u969c\u5bb3\u7269\u306b\u5411\u304b\u3063\u3066\u3001\u4f55\u30de\u30b9\u3067\u3082\u307e\u3063\u3059\u3050\u5f3e\u304d\u98db\u3070\u3055\u308c\u308b\uff08\u4ed6\u306e\u30ad\u30e3\u30e9\u306e\u3044\u308b\u30de\u30b9\u306f\u901a\u904e\u3059\u308b\uff09\u3002\u58c1\u307e\u305f\u306f\u969c\u5bb3\u7269\u306b\u63a5\u89e6\u3057\u305f\u6642\u70b9\u3067\u3001\u6575\u306f\u3055\u3089\u306b1\u30c0\u30e1\u30fc\u30b8\u3092\u53d7\u3051\u308b\u3002\u6575\u306f\u3053\u306e\u6fc0\u7a81\u30c0\u30e1\u30fc\u30b8\u306b\u5bfe\u3057\u3066\u6539\u3081\u3066\u300e\u56de\u907f\u5224\u5b9a\u300f\u3092\u884c\u3063\u3066\u3082\u826f\u3044\u3002","\u300c\u30a4\u30e4\u30fc\u30c3\uff01\u300d\u982d\u90e8\u3078\u306e\u75db\u70c8\u306a\u30ab\u30e9\u30c6\uff01\u3000\u773c\u7403\u7834\u58ca\u3082\u3057\u304f\u306f\u6fc0\u3057\u3044\u8133\u9707\u76ea\u304c\u6575\u3092\u8972\u3046\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u3055\u3089\u306b\u6575\u306e\u3010\u30cb\u30e5\u30fc\u30ed\u30f3\u3011\u3068\u3010\u30ef\u30b6\u30de\u30a8\u3011\u304c\u305d\u308c\u305e\u308c1\u305a\u3064\u6e1b\u5c11\u3059\u308b\uff08\u3053\u308c\u306b\u3088\u308b\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u82e6\u3057\u307f\u629c\u3044\u3066\u6b7b\u306c\u304c\u3044\u3044\u300d\u6025\u6240\u3092\u60c5\u3051\u5bb9\u8d66\u306a\u304f\u7834\u58ca\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8+1\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u8010\u3048\u96e3\u3044\u82e6\u75db\u306b\u3088\u308a\u3001\u6575\u306f\u3010\u7cbe\u795e\u529b\u3011\u304c-2\u3055\u308c\u3001\u3010\u30cb\u30e5\u30fc\u30ed\u30f3\u3011\u304c1\u6e1b\u5c11\u3059\u308b\uff08\u3053\u308c\u306b\u3088\u308b\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u9003\u3052\u3089\u308c\u308b\u3082\u306e\u306a\u3089\u9003\u3052\u3066\u307f\u3088\u300d\u6575\u306e\u811a\u3092\u7c89\u7815\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u3055\u3089\u306b\u6575\u306e\u3010\u811a\u529b\u3011\u304cD3\u6e1b\u5c11\u3059\u308b\uff08\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u3053\u308c\u3067\u624b\u3082\u8db3\u3082\u51fa\u307e\u3044\uff01\u300d\u6575\u306e\u4e21\u8155\u3092\u5207\u308a\u98db\u3070\u3057\u305f\uff01\u3000\u9bae\u8840\u304c\u30b9\u30d7\u30ea\u30f3\u30af\u30e9\u30fc\u3081\u3044\u3066\u5674\u304d\u51fa\u3059\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8+1\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u3055\u3089\u306b\u6575\u306e\u3010\u30ef\u30b6\u30de\u30a8\u3011\u3068\u3010\u30ab\u30e9\u30c6\u3011\u304c\u305d\u308c\u305e\u308c2\u6e1b\u5c11\u3059\u308b\uff08\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u30a4\u30a4\u30a4\u30e4\u30a2\u30a2\u30a2\u30a2\u30fc\u30fc\u30fc\u30fc\u30c3\uff01\u300d\u30e4\u30ea\u3081\u3044\u305f\u30c1\u30e7\u30c3\u30d7\u304c\u6575\u306e\u80f8\u3092\u8cab\u901a\uff01\u3000\u3055\u3089\u306b\u5fc3\u81d3\u3092\u63b4\u307f\u53d6\u308a\u3001\u63e1\u308a\u3064\u3076\u3057\u305f\uff01\u3000\u30ca\u30e0\u30a2\u30df\u30c0\u30d6\u30c4\uff01\uff1a\u6575\u306f\u6b8b\u308a\u3010\u4f53\u529b\u3011\u306b\u95a2\u4fc2\u306a\u304f\u5373\u6b7b\u3059\u308b\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD6\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD6\u4e0a\u6607\u3059\u308b\u3002"].$freeze()),T(d[0],"TABLES",O(["SB"],{SB:e(p("DiceTable"),"Table").$new("\u30b5\u30c4\u30d0\u30c4\u8868","1D6",p("SATSUBATSU_TABLE"))}).$freeze()),N.$register_prefix("NJ","EV","AT","EL",p("TABLES").$keys())})}}]);