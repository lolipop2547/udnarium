(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[1377],{5762:(Q,X,k)=>{k(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(s){var o,p,b,H,F,U,x,D,A=[],w=s.nil,e=s.$$$,g=s.module,R=s.hash2,T=s.truthy,d=s.def;return o=A,p=D=[g(A[0],"BCDice")].concat(o),x=[U=g(D[0],"ArithmeticEvaluator")].concat(p),H=[b=s.get_singleton_class(U)].concat(x),F=s.$r(H),d(b,"$eval",function(G,L){var S,M=w;if(null==L)L=R([],{});else if(!L.$$is_hash)throw s.ArgumentError.$new("expected kwargs");return null==(S=L.$$smap.round_type)&&(S=e(F("RoundType"),"FLOOR")),T(G)&&T(M=F("Arithmetic").$eval(G,S))?M:0},-2)},Opal.queue(function(s){var G,j,J,t,_,r,a,h,c,l,I,C,W,S,w=[],e=s.nil,g=s.$$$,R=s.module,T=s.klass,d=s.const_set,E=s.send,o=s.def,y=s.send2,D=s.find_super,v=s.truthy,p=s.eqeqeq,U=s.hash2,x=s.rb_plus,b=s.to_a,P=s.rb_minus,H=s.rb_ge,F=s.rb_le;return s.top.$require("bcdice/arithmetic_evaluator"),G=w,j=S=[R(w[0],"BCDice")].concat(G),C=[R(S[0],"GameSystem")].concat(j),W=s.$r(C),J=C,c=[h=T(C[0],W("Base"),"SRS")].concat(J),l=s.$r(c),(I=h.$$prototype).round_type=I.randomizer=I.sort_add_dice=e,d(c[0],"ID","SRS"),d(c[0],"NAME","\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9RPG\u30b7\u30b9\u30c6\u30e0"),d(c[0],"SORT_KEY","\u3059\u305f\u3093\u305f\u3042\u3068RPG\u3057\u3059\u3066\u3080"),d(c[0],"HELP_MESSAGE_1","\u30fb\u5224\u5b9a\n\u3000\u30fb\u901a\u5e38\u5224\u5b9a\uff1a2D6+m>=t[c,f]\n\u3000\u3000\u4fee\u6b63\u5024m\u3001\u76ee\u6a19\u5024t\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024c\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024f\u3067\u5224\u5b9a\u30ed\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000\u4fee\u6b63\u5024\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306f\u7701\u7565\u53ef\u80fd\u3067\u3059\uff08[]\u3054\u3068\u7701\u7565\u53ef\uff09\u3002\n\u3000\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306e\u65e2\u5b9a\u5024\u306f\u3001\u305d\u308c\u305e\u308c12\u30012\u3067\u3059\u3002\n\u3000\u3000\u81ea\u52d5\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u3001\u6210\u529f\u3001\u5931\u6557\u3092\u81ea\u52d5\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u3000\u3000\u4f8b) 2d6>=10\u3000\u3000\u3000\u3000\u3000\u4fee\u6b63\u50240\u3001\u76ee\u6a19\u502410\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10\u3000\u3000\u3000\u3000\u4fee\u6b63\u5024+2\u3001\u76ee\u6a19\u502410\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10[11]\u3000\u3000\u2191\u3092\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502411\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10[12,4]\u3000\u2191\u3092\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50244\u3067\u5224\u5b9a\n"),d(c[0],"HELP_MESSAGE_2","\u3000\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u304a\u3088\u3073\u30d5\u30a1\u30f3\u30d6\u30eb\u306e\u307f\u306e\u5224\u5b9a\uff1a2D6+m[c,f]\n\u3000\u3000\u76ee\u6a19\u5024\u3092\u6307\u5b9a\u305b\u305a\u3001\u4fee\u6b63\u5024m\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024c\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024f\u3067\u5224\u5b9a\u30ed\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000\u4fee\u6b63\u5024\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306f\u7701\u7565\u53ef\u80fd\u3067\u3059\uff08[]\u306f\u7701\u7565\u4e0d\u53ef\uff09\u3002\n\u3000\u3000\u81ea\u52d5\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u3092\u81ea\u52d5\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u3000\u3000\u4f8b) 2d6[]\u3000\u3000\u3000\u3000\u4fee\u6b63\u50240\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50242\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2[11]\u3000\u3000\u4fee\u6b63\u5024+2\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502411\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50242\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2[12,4]\u3000\u4fee\u6b63\u5024+2\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50244\u3067\u5224\u5b9a\n"),d(c[0],"HELP_MESSAGE_3","\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\uff08\u5165\u308c\u66ff\u3048\u306a\u3057)\n"),d(c[0],"DEFAULT_HELP_MESSAGE",l("HELP_MESSAGE_1")+"\n"+l("HELP_MESSAGE_2")+"\n"+l("HELP_MESSAGE_3")),d(c[0],"HELP_MESSAGE",l("DEFAULT_HELP_MESSAGE")),t=c,r=[_=R(c[0],"ClassMethods")].concat(t),a=s.$r(r),_.$attr_reader("help_message"),_.$attr_reader("aliases_re_for_srs_roll_with_target_value"),_.$attr_reader("aliases_re_for_srs_roll_without_target_value"),o(_,"$set_aliases_for_srs_roll",function(i){var f,n=this,V=e,q=e;return f=s.slice.call(arguments),V=E(f,"map",[],"upcase".$to_proc()),q=E(V,"map",[],function(z){return null==z&&(z=e),a("Regexp").$escape(z)},1).$join("|"),n.aliases_re_for_srs_roll_with_target_value=a("Regexp").$new("^(?:"+q+")((?:[-+][-+\\d]+)?>=\\d+(?:\\[\\d*(?:,\\d+)?\\])?)$"),n.aliases_re_for_srs_roll_without_target_value=a("Regexp").$new("^(?:"+q+")([-+][-+\\d]+)?(\\[\\d*(?:,\\d+)?\\])?$"),n.$prepare_help_msg_for_aliases_for_srs_roll(V),n.help_message=n.$concatenate_help_messages(),n},-1),o(_,"$clear_aliases_for_srs_roll",function(){var i=this;return i.aliases_re_for_srs_roll_with_target_value=e,i.aliases_re_for_srs_roll_without_target_value=e,i.help_message=g(a("SRS"),"DEFAULT_HELP_MESSAGE"),i},0),_.$private(),o(_,"$prepare_help_msg_for_aliases_for_srs_roll",function(i){var f=this;return f.help_msg_for_aliases_for_srs_roll_with_target_value=E(i,"map",[],function(n){return null==n&&(n=e),"\u3000\u3000\u4f8b) "+n+"+2>=10\u3000\u3000\u3000\u3000 2d6+2>=10\u3068\u540c\u3058\uff08"+n+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n"},1).$join(),f.help_msg_for_aliases_for_srs_roll_without_target_value=E(i,"map",[],function(n){return null==n&&(n=e),"\u3000\u3000\u4f8b) "+n+"\u3000\u3000\u3000\u3000\u3000 2d6[]\u3068\u540c\u3058\uff08"+n+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n\u3000\u3000\u4f8b) "+n+"+2[12,4]\u3000 2d6+2[12,4]\u3068\u540c\u3058\uff08"+n+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n"},1).$join(),f},1),o(_,"$concatenate_help_messages",function(){var i=this;return null==i.help_msg_for_aliases_for_srs_roll_with_target_value&&(i.help_msg_for_aliases_for_srs_roll_with_target_value=e),null==i.help_msg_for_aliases_for_srs_roll_without_target_value&&(i.help_msg_for_aliases_for_srs_roll_without_target_value=e),g(a("SRS"),"HELP_MESSAGE_1")+(i.help_msg_for_aliases_for_srs_roll_with_target_value+"\n")+g(a("SRS"),"HELP_MESSAGE_2")+i.help_msg_for_aliases_for_srs_roll_without_target_value+"\n"+g(a("SRS"),"HELP_MESSAGE_3")},0),function($,t){var _=[$].concat(t),r=s.$r(_);o($,"$inherited",function(u){return u.$extend(r("ClassMethods")).$clear_aliases_for_srs_roll()},1),o($,"$help_message",function(){return r("DEFAULT_HELP_MESSAGE")},0),o($,"$aliases_re_for_srs_roll_with_target_value",function(){return e},0),o($,"$aliases_re_for_srs_roll_without_target_value",function(){return e},0)}(s.get_singleton_class(h),c),h.$register_prefix("2D6"),o(h,"$initialize",function $(t){var r=this;return delete $.$$p,y(r,D(r,"initialize",$,!1,!0),"initialize",[t],null),r.sort_add_dice=!0,r.d66_sort_type=g(l("D66SortType"),"NO_SORT")},1),o(h,"$help_message",function(){return this.$class().$help_message()},0),d(c[0],"DEFAULT_CRITICAL_VALUE",12),d(c[0],"DEFAULT_FUMBLE_VALUE",2),d(c[0],"SRS_ROLL_WITH_TARGET_VALUE_RE",/^2D6([-+][-+\d]+)?>=(\d+)(?:\[(\d+)?(?:,(\d+))?\])?$/.$freeze()),d(c[0],"SRS_ROLL_WITHOUT_TARGET_VALUE_RE",/^2D6([-+][-+\d]+)?\[(\d+)?(?:,(\d+))?\]$/.$freeze()),d(c[0],"SRS_ROLL_DEFAULT_THRESHOLDS","["+l("DEFAULT_CRITICAL_VALUE")+","+l("DEFAULT_FUMBLE_VALUE")+"]"),d(c[0],"SRSRollNode",E(l("Struct"),"new",["modifier","critical_value","fumble_value","target_value"],function $(){return o(null==$.$$s?this:$.$$s,"$to_s",function(){var a,r=this;return a="2D6"+l("Format").$modifier(r.$modifier()),(v(r.$target_value())?a+">="+r.$target_value():a)+"["+r.$critical_value()+","+r.$fumble_value()+"]"},0)},{$$arity:0,$$s:h})),o(h,"$eval_game_system_specific_command",function(t){var r,a,_=this;return r=_.$replace_alias_for_srs_roll_with_2d6(t),v(a=_.$parse(r))?_.$execute_srs_roll(a):e},1),h.$private(),o(h,"$replace_alias_for_srs_roll_with_2d6",function(t){var r,i=e;return p(this.$class().$aliases_re_for_srs_roll_with_target_value(),r=t)?"2D6"+l("Regexp").$last_match(1):p(this.$class().$aliases_re_for_srs_roll_without_target_value(),r)?"2D6"+l("Regexp").$last_match(1)+(v(i=l("Regexp").$last_match(2))?i:l("SRS_ROLL_DEFAULT_THRESHOLDS")):t},1),o(h,"$parse",function(t){var r;return p(l("SRS_ROLL_WITH_TARGET_VALUE_RE"),r=t)?this.$parse_srs_roll_with_target_value(l("Regexp").$last_match()):p(l("SRS_ROLL_WITHOUT_TARGET_VALUE_RE"),r)?this.$parse_srs_roll_without_target_value(l("Regexp").$last_match()):e},1),o(h,"$eval_modifier",function(t){return v(t)?l("ArithmeticEvaluator").$eval(t,U(["round_type"],{round_type:this.round_type})):0},1),o(h,"$parse_srs_roll_with_target_value",function(t){var _,r,u,i,f,n,m=e;return u=this.$eval_modifier(t["$[]"](1)),i=t["$[]"](2).$to_i(),f=v(m=(_=t["$[]"](3))===e||null==_?e:E(_,"to_i",[]))?m:l("DEFAULT_CRITICAL_VALUE"),n=v(m=(r=t["$[]"](4))===e||null==r?e:E(r,"to_i",[]))?m:l("DEFAULT_FUMBLE_VALUE"),l("SRSRollNode").$new(u,f,n,i)},1),o(h,"$parse_srs_roll_without_target_value",function(t){var _,r,u,i,m,f=e;return u=this.$eval_modifier(t["$[]"](1)),i=v(f=(_=t["$[]"](2))===e||null==_?e:E(_,"to_i",[]))?f:l("DEFAULT_CRITICAL_VALUE"),m=v(f=(r=t["$[]"](3))===e||null==r?e:E(r,"to_i",[]))?f:l("DEFAULT_FUMBLE_VALUE"),l("SRSRollNode").$new(u,i,m,e)},1),o(h,"$execute_srs_roll",function(t){var a,u,i,n,_=this,r=e,f=e;return r=_.randomizer.$roll_barabara(2,6),v(_.sort_add_dice)&&r["$sort!"](),a=r.$sum(),u=r.$join(","),i=x(a,t.$modifier()),f=_.$compare_result(t,a,i),n=[["("+t+")",a+"["+u+"]"+l("Format").$modifier(t.$modifier()),i,f.$text()].$compact().$join(" \uff1e ")],E(f,"text=",b(n)),P(n.length,1),f},1),o(h,"$compare_result",function(t,_,r){return v(H(_,t.$critical_value()))?l("Result").$critical("\u81ea\u52d5\u6210\u529f"):v(F(_,t.$fumble_value()))?l("Result").$fumble("\u81ea\u52d5\u5931\u6557"):v(t.$target_value()["$nil?"]())?l("Result").$new():v(H(r,t.$target_value()))?l("Result").$success("\u6210\u529f"):l("Result").$failure("\u5931\u6557")},3)})}}]);