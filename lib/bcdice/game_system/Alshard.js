(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[6420],{7058:(Q,X,B)=>{B(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(r){var $,p,H,M,L,R,F,G,U=[],A=r.nil,e=r.$$$,g=r.module,w=r.hash2,S=r.truthy,c=r.def;return $=U,p=G=[g(U[0],"BCDice")].concat($),F=[R=g(G[0],"ArithmeticEvaluator")].concat(p),M=[H=r.get_singleton_class(R)].concat(F),L=r.$r(M),c(H,"$eval",function(P,y){var D,C=A;if(null==y)y=w([],{});else if(!y.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(D=y.$$smap.round_type)&&(D=e(L("RoundType"),"FLOOR")),S(P)&&S(C=L("Arithmetic").$eval(P,D))?C:0},-2)},Opal.modules["bcdice/game_system/SRS"]=function(r){var P,N,J,s,_,t,l,m,d,a,V,I,W,D,A=[],e=r.nil,g=r.$$$,w=r.module,S=r.klass,c=r.const_set,E=r.send,$=r.def,b=r.send2,G=r.find_super,h=r.truthy,p=r.eqeqeq,R=r.hash2,F=r.rb_plus,H=r.to_a,x=r.rb_minus,M=r.rb_ge,L=r.rb_le;return r.top.$require("bcdice/arithmetic_evaluator"),P=A,N=D=[w(A[0],"BCDice")].concat(P),I=[w(D[0],"GameSystem")].concat(N),W=r.$r(I),J=I,d=[m=S(I[0],W("Base"),"SRS")].concat(J),a=r.$r(d),(V=m.$$prototype).round_type=V.randomizer=V.sort_add_dice=e,c(d[0],"ID","SRS"),c(d[0],"NAME","\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9RPG\u30b7\u30b9\u30c6\u30e0"),c(d[0],"SORT_KEY","\u3059\u305f\u3093\u305f\u3042\u3068RPG\u3057\u3059\u3066\u3080"),c(d[0],"HELP_MESSAGE_1","\u30fb\u5224\u5b9a\n\u3000\u30fb\u901a\u5e38\u5224\u5b9a\uff1a2D6+m>=t[c,f]\n\u3000\u3000\u4fee\u6b63\u5024m\u3001\u76ee\u6a19\u5024t\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024c\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024f\u3067\u5224\u5b9a\u30ed\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000\u4fee\u6b63\u5024\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306f\u7701\u7565\u53ef\u80fd\u3067\u3059\uff08[]\u3054\u3068\u7701\u7565\u53ef\uff09\u3002\n\u3000\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306e\u65e2\u5b9a\u5024\u306f\u3001\u305d\u308c\u305e\u308c12\u30012\u3067\u3059\u3002\n\u3000\u3000\u81ea\u52d5\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u3001\u6210\u529f\u3001\u5931\u6557\u3092\u81ea\u52d5\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u3000\u3000\u4f8b) 2d6>=10\u3000\u3000\u3000\u3000\u3000\u4fee\u6b63\u50240\u3001\u76ee\u6a19\u502410\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10\u3000\u3000\u3000\u3000\u4fee\u6b63\u5024+2\u3001\u76ee\u6a19\u502410\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10[11]\u3000\u3000\u2191\u3092\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502411\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10[12,4]\u3000\u2191\u3092\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50244\u3067\u5224\u5b9a\n"),c(d[0],"HELP_MESSAGE_2","\u3000\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u304a\u3088\u3073\u30d5\u30a1\u30f3\u30d6\u30eb\u306e\u307f\u306e\u5224\u5b9a\uff1a2D6+m[c,f]\n\u3000\u3000\u76ee\u6a19\u5024\u3092\u6307\u5b9a\u305b\u305a\u3001\u4fee\u6b63\u5024m\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024c\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024f\u3067\u5224\u5b9a\u30ed\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000\u4fee\u6b63\u5024\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306f\u7701\u7565\u53ef\u80fd\u3067\u3059\uff08[]\u306f\u7701\u7565\u4e0d\u53ef\uff09\u3002\n\u3000\u3000\u81ea\u52d5\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u3092\u81ea\u52d5\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u3000\u3000\u4f8b) 2d6[]\u3000\u3000\u3000\u3000\u4fee\u6b63\u50240\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50242\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2[11]\u3000\u3000\u4fee\u6b63\u5024+2\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502411\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50242\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2[12,4]\u3000\u4fee\u6b63\u5024+2\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50244\u3067\u5224\u5b9a\n"),c(d[0],"HELP_MESSAGE_3","\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\uff08\u5165\u308c\u66ff\u3048\u306a\u3057)\n"),c(d[0],"DEFAULT_HELP_MESSAGE",a("HELP_MESSAGE_1")+"\n"+a("HELP_MESSAGE_2")+"\n"+a("HELP_MESSAGE_3")),c(d[0],"HELP_MESSAGE",a("DEFAULT_HELP_MESSAGE")),s=d,t=[_=w(d[0],"ClassMethods")].concat(s),l=r.$r(t),_.$attr_reader("help_message"),_.$attr_reader("aliases_re_for_srs_roll_with_target_value"),_.$attr_reader("aliases_re_for_srs_roll_without_target_value"),$(_,"$set_aliases_for_srs_roll",function(i){var f,n=this,q=e,k=e;return f=r.slice.call(arguments),q=E(f,"map",[],"upcase".$to_proc()),k=E(q,"map",[],function(z){return null==z&&(z=e),l("Regexp").$escape(z)},1).$join("|"),n.aliases_re_for_srs_roll_with_target_value=l("Regexp").$new("^(?:"+k+")((?:[-+][-+\\d]+)?>=\\d+(?:\\[\\d*(?:,\\d+)?\\])?)$"),n.aliases_re_for_srs_roll_without_target_value=l("Regexp").$new("^(?:"+k+")([-+][-+\\d]+)?(\\[\\d*(?:,\\d+)?\\])?$"),n.$prepare_help_msg_for_aliases_for_srs_roll(q),n.help_message=n.$concatenate_help_messages(),n},-1),$(_,"$clear_aliases_for_srs_roll",function(){var i=this;return i.aliases_re_for_srs_roll_with_target_value=e,i.aliases_re_for_srs_roll_without_target_value=e,i.help_message=g(l("SRS"),"DEFAULT_HELP_MESSAGE"),i},0),_.$private(),$(_,"$prepare_help_msg_for_aliases_for_srs_roll",function(i){var f=this;return f.help_msg_for_aliases_for_srs_roll_with_target_value=E(i,"map",[],function(n){return null==n&&(n=e),"\u3000\u3000\u4f8b) "+n+"+2>=10\u3000\u3000\u3000\u3000 2d6+2>=10\u3068\u540c\u3058\uff08"+n+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n"},1).$join(),f.help_msg_for_aliases_for_srs_roll_without_target_value=E(i,"map",[],function(n){return null==n&&(n=e),"\u3000\u3000\u4f8b) "+n+"\u3000\u3000\u3000\u3000\u3000 2d6[]\u3068\u540c\u3058\uff08"+n+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n\u3000\u3000\u4f8b) "+n+"+2[12,4]\u3000 2d6+2[12,4]\u3068\u540c\u3058\uff08"+n+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n"},1).$join(),f},1),$(_,"$concatenate_help_messages",function(){var i=this;return null==i.help_msg_for_aliases_for_srs_roll_with_target_value&&(i.help_msg_for_aliases_for_srs_roll_with_target_value=e),null==i.help_msg_for_aliases_for_srs_roll_without_target_value&&(i.help_msg_for_aliases_for_srs_roll_without_target_value=e),g(l("SRS"),"HELP_MESSAGE_1")+(i.help_msg_for_aliases_for_srs_roll_with_target_value+"\n")+g(l("SRS"),"HELP_MESSAGE_2")+i.help_msg_for_aliases_for_srs_roll_without_target_value+"\n"+g(l("SRS"),"HELP_MESSAGE_3")},0),function(o,s){var _=[o].concat(s),t=r.$r(_);$(o,"$inherited",function(u){return u.$extend(t("ClassMethods")).$clear_aliases_for_srs_roll()},1),$(o,"$help_message",function(){return t("DEFAULT_HELP_MESSAGE")},0),$(o,"$aliases_re_for_srs_roll_with_target_value",function(){return e},0),$(o,"$aliases_re_for_srs_roll_without_target_value",function(){return e},0)}(r.get_singleton_class(m),d),m.$register_prefix("2D6"),$(m,"$initialize",function o(s){var t=this;return delete o.$$p,b(t,G(t,"initialize",o,!1,!0),"initialize",[s],null),t.sort_add_dice=!0,t.d66_sort_type=g(a("D66SortType"),"NO_SORT")},1),$(m,"$help_message",function(){return this.$class().$help_message()},0),c(d[0],"DEFAULT_CRITICAL_VALUE",12),c(d[0],"DEFAULT_FUMBLE_VALUE",2),c(d[0],"SRS_ROLL_WITH_TARGET_VALUE_RE",/^2D6([-+][-+\d]+)?>=(\d+)(?:\[(\d+)?(?:,(\d+))?\])?$/.$freeze()),c(d[0],"SRS_ROLL_WITHOUT_TARGET_VALUE_RE",/^2D6([-+][-+\d]+)?\[(\d+)?(?:,(\d+))?\]$/.$freeze()),c(d[0],"SRS_ROLL_DEFAULT_THRESHOLDS","["+a("DEFAULT_CRITICAL_VALUE")+","+a("DEFAULT_FUMBLE_VALUE")+"]"),c(d[0],"SRSRollNode",E(a("Struct"),"new",["modifier","critical_value","fumble_value","target_value"],function o(){return $(null==o.$$s?this:o.$$s,"$to_s",function(){var l,t=this;return l="2D6"+a("Format").$modifier(t.$modifier()),(h(t.$target_value())?l+">="+t.$target_value():l)+"["+t.$critical_value()+","+t.$fumble_value()+"]"},0)},{$$arity:0,$$s:m})),$(m,"$eval_game_system_specific_command",function(s){var t,l,_=this;return t=_.$replace_alias_for_srs_roll_with_2d6(s),h(l=_.$parse(t))?_.$execute_srs_roll(l):e},1),m.$private(),$(m,"$replace_alias_for_srs_roll_with_2d6",function(s){var t,i=e;return p(this.$class().$aliases_re_for_srs_roll_with_target_value(),t=s)?"2D6"+a("Regexp").$last_match(1):p(this.$class().$aliases_re_for_srs_roll_without_target_value(),t)?"2D6"+a("Regexp").$last_match(1)+(h(i=a("Regexp").$last_match(2))?i:a("SRS_ROLL_DEFAULT_THRESHOLDS")):s},1),$(m,"$parse",function(s){var t;return p(a("SRS_ROLL_WITH_TARGET_VALUE_RE"),t=s)?this.$parse_srs_roll_with_target_value(a("Regexp").$last_match()):p(a("SRS_ROLL_WITHOUT_TARGET_VALUE_RE"),t)?this.$parse_srs_roll_without_target_value(a("Regexp").$last_match()):e},1),$(m,"$eval_modifier",function(s){return h(s)?a("ArithmeticEvaluator").$eval(s,R(["round_type"],{round_type:this.round_type})):0},1),$(m,"$parse_srs_roll_with_target_value",function(s){var _,t,u,i,f,n,v=e;return u=this.$eval_modifier(s["$[]"](1)),i=s["$[]"](2).$to_i(),f=h(v=(_=s["$[]"](3))===e||null==_?e:E(_,"to_i",[]))?v:a("DEFAULT_CRITICAL_VALUE"),n=h(v=(t=s["$[]"](4))===e||null==t?e:E(t,"to_i",[]))?v:a("DEFAULT_FUMBLE_VALUE"),a("SRSRollNode").$new(u,f,n,i)},1),$(m,"$parse_srs_roll_without_target_value",function(s){var _,t,u,i,v,f=e;return u=this.$eval_modifier(s["$[]"](1)),i=h(f=(_=s["$[]"](2))===e||null==_?e:E(_,"to_i",[]))?f:a("DEFAULT_CRITICAL_VALUE"),v=h(f=(t=s["$[]"](3))===e||null==t?e:E(t,"to_i",[]))?f:a("DEFAULT_FUMBLE_VALUE"),a("SRSRollNode").$new(u,i,v,e)},1),$(m,"$execute_srs_roll",function(s){var l,u,i,n,_=this,t=e,f=e;return t=_.randomizer.$roll_barabara(2,6),h(_.sort_add_dice)&&t["$sort!"](),l=t.$sum(),u=t.$join(","),i=F(l,s.$modifier()),f=_.$compare_result(s,l,i),n=[["("+s+")",l+"["+u+"]"+a("Format").$modifier(s.$modifier()),i,f.$text()].$compact().$join(" \uff1e ")],E(f,"text=",H(n)),x(n.length,1),f},1),$(m,"$compare_result",function(s,_,t){return h(M(_,s.$critical_value()))?a("Result").$critical("\u81ea\u52d5\u6210\u529f"):h(L(_,s.$fumble_value()))?a("Result").$fumble("\u81ea\u52d5\u5931\u6557"):h(s.$target_value()["$nil?"]())?a("Result").$new():h(M(t,s.$target_value()))?a("Result").$success("\u6210\u529f"):a("Result").$failure("\u5931\u6557")},3)},Opal.queue(function(r){var E,h,M,L,T,R,F,b,A=[],g=r.module,w=r.klass,S=r.const_set;return r.top.$require("bcdice/game_system/SRS"),E=A,h=b=[g(A[0],"BCDice")].concat(E),R=[g(b[0],"GameSystem")].concat(h),F=r.$r(R),M=R,S((T=[L=w(R[0],F("SRS"),"Alshard")].concat(M))[0],"NAME","\u30a2\u30eb\u30b7\u30e3\u30fc\u30c9"),S(T[0],"SORT_KEY","\u3042\u308b\u3057\u3084\u3042\u3068"),S(T[0],"ID","Alshard"),L.$register_prefix("2D6","AL"),L.$set_aliases_for_srs_roll("AL"),S(T[0],"HELP_MESSAGE",L.$help_message())})}}]);