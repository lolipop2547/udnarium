(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[3364],{2605:(O,ee,j)=>{j(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(i){var b,S,a,I,A,q,c,u,G=[],P=i.nil,t=i.$$$,z=i.module,L=i.hash2,R=i.truthy,F=i.def;return b=G,S=u=[z(G[0],"BCDice")].concat(b),c=[q=z(u[0],"ArithmeticEvaluator")].concat(S),I=[a=i.get_singleton_class(q)].concat(c),A=i.$r(I),F(a,"$eval",function(D,k){var y,M=P;if(null==k)k=L([],{});else if(!k.$$is_hash)throw i.ArgumentError.$new("expected kwargs");return null==(y=k.$$smap.round_type)&&(y=t(A("RoundType"),"FLOOR")),R(D)&&R(M=A("Arithmetic").$eval(D,y))?M:0},-2)},Opal.queue(function(i){var y,Q,Z,r,n,h,l,d,B,E,T,N,V,Y,P=[],t=i.nil,z=i.module,L=i.klass,R=i.const_set,F=i.send2,H=i.find_super,b=i.def,v=i.eqeqeq,u=i.truthy,x=i.rb_le,S=i.rb_gt,q=i.rb_plus,c=i.send,a=i.to_a,f=i.rb_minus,I=i.rb_divide,A=i.rb_times,K=i.rb_lt,D=i.rb_ge;return i.top.$require("bcdice/arithmetic_evaluator"),y=P,Q=Y=[z(P[0],"BCDice")].concat(y),N=[z(Y[0],"GameSystem")].concat(Q),V=i.$r(N),Z=N,B=[d=L(N[0],V("Base"),"Cthulhu")].concat(Z),E=i.$r(B),(T=d.$$prototype).randomizer=T.locale=T.special_percentage=T.critical_percentage=T.fumble_percentage=t,R(B[0],"ID","Cthulhu"),R(B[0],"NAME","\u30af\u30c8\u30a5\u30eb\u30d5\u795e\u8a71TRPG"),R(B[0],"SORT_KEY","\u304f\u3068\u3046\u308b\u3075\u3057\u3093\u308fTRPG"),R(B[0],"HELP_MESSAGE","c=\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024 \uff0f f=\u30d5\u30a1\u30f3\u30d6\u30eb\u5024 \uff0f s=\u30b9\u30da\u30b7\u30e3\u30eb\n\n1d100<=n    c\u30fbf\u30fbs\u3059\u3079\u3066\u30aa\u30d5\uff08\u5358\u7d14\u306a\u6570\u5024\u6bd4\u8f03\u5224\u5b9a\u306e\u307f\u884c\u3044\u307e\u3059\uff09\n\n\u30fbcfs\u5224\u5b9a\u4ed8\u304d\u5224\u5b9a\u30b3\u30de\u30f3\u30c9\n\nCC\t 1d100\u30ed\u30fc\u30eb\u3092\u884c\u3046 c=1\u3001f=100\nCCB  \u540c\u4e0a\u3001c=5\u3001f=96\n\n\u4f8b\uff1aCC<=80  \uff08\u6280\u80fd\u502480\u3067\u884c\u70ba\u5224\u5b9a\u30021%\u30eb\u30fc\u30eb\u3067cf\u9069\u7528\uff09\n\u4f8b\uff1aCCB<=55 \uff08\u6280\u80fd\u502455\u3067\u884c\u70ba\u5224\u5b9a\u30025%\u30eb\u30fc\u30eb\u3067cf\u9069\u7528\uff09\n\n\u30fb\u7d44\u307f\u5408\u308f\u305b\u30ed\u30fc\u30eb\u306b\u3064\u3044\u3066\n\nCBR(x,y)\tc=1\u3001f=100\nCBRB(x,y)\tc=5\u3001f=96\n\n\u30fb\u62b5\u6297\u8868\u30ed\u30fc\u30eb\u306b\u3064\u3044\u3066\nRES(x-y)\tc=1\u3001f=100\nRESB(x-y)\tc=5\u3001f=96\n\n\u203b\u6545\u969c\u30ca\u30f3\u30d0\u30fc\u5224\u5b9a\n\n\u30fbCC(x) c=1\u3001f=100\nx=\u6545\u969c\u30ca\u30f3\u30d0\u30fc\u3002\u51fa\u76eex\u4ee5\u4e0a\u304c\u51fa\u305f\u4e0a\u3067\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u304c\u540c\u6642\u306b\u767a\u751f\u3057\u305f\u5834\u5408\u3001\u5171\u306b\u51fa\u529b\u3059\u308b\uff08\u30c6\u30ad\u30b9\u30c8\u300c\u30d5\u30a1\u30f3\u30d6\u30eb\uff06\u6545\u969c\u300d\uff09\n\u30d5\u30a1\u30f3\u30d6\u30eb\u3067\u306a\u3044\u5834\u5408\u3001\u6210\u529f\u30fb\u5931\u6557\u306b\u95a2\u308f\u3089\u305a\u30c6\u30ad\u30b9\u30c8\u300c\u6545\u969c\u300d\u306e\u307f\u3092\u51fa\u529b\u3059\u308b\uff08\u6210\u529f\u30fb\u5931\u6557\u3092\u51fa\u529b\u305b\u305a\u3001\u4e0a\u66f8\u304d\u3057\u305f\u3082\u306e\u3092\u51fa\u529b\u3059\u308b\u5f62\uff09\n\n\u30fbCCB(x) c=5\u3001f=96\n\u540c\u4e0a\n\n"),d.$register_prefix("CCB?","RESB?","CBRB?"),b(d,"$initialize",function p($){var n=this;return delete p.$$p,F(n,H(n,"initialize",p,!1,!0),"initialize",[$],null),n.special_percentage=20,n.critical_percentage=1,n.fumble_percentage=1},1),b(d,"$eval_game_system_specific_command",function($){var n,r=this;return v(/CCB/i,n=$)?(r.critical_percentage=5,r.fumble_percentage=5,r.$getCheckResult($)):v(/CC/i,n)?(r.critical_percentage=1,r.fumble_percentage=1,r.$getCheckResult($)):v(/RESB/i,n)?(r.critical_percentage=5,r.fumble_percentage=5,r.$getRegistResult($)):v(/CBRB/i,n)?(r.critical_percentage=5,r.fumble_percentage=5,r.$getCombineRoll($)):v(/RES/i,n)?(r.critical_percentage=1,r.fumble_percentage=1,r.$getRegistResult($)):v(/CBR/i,n)?(r.critical_percentage=1,r.fumble_percentage=1,r.$getCombineRoll($)):t},1),d.$private(),b(d,"$getCheckResult",function($){var r=this,n=t,h=t,l=t,_=t,e=t,o=t;return n=/^CCB?(\d+)?(?:<=([+-\/*\d]+))?$/i.$match($),u(n)?(h=n["$[]"](1).$to_i(),l=E("ArithmeticEvaluator").$eval(n["$[]"](2)),u(x(l,0))?(_=r.randomizer.$roll_once(100),E("Result").$new("(1D100) \uff1e "+_)):(e="(1D100<="+l+")",u(S(h,0))&&(e=q(e," "+r.$translate("Cthulhu.broken_number")+"["+h+"]")),_=r.randomizer.$roll_once(100),o=r.$compare(_,l,h),c(o.$to_result(),"tap",[],function(C){var s;return null==C&&(C=t),s=[e+" \uff1e "+_+" \uff1e "+o.$text()],c(C,"text=",a(s)),s[f(s.length,1)]},1))):t},1),r=B,h=[n=L(B[0],null,"CompareResult")].concat(r),l=i.$r(h),n.$include(l("Translate")),n.$attr_accessor("success","failure","critical","fumble","special","broken"),b(n,"$initialize",function(e){var o=this;return o.locale=e,o.success=!1,o.failure=!1,o.critical=!1,o.fumble=!1,o.special=!1,o.broke=!1},1),b(n,"$text",function(){var e=this;return u(e.$critical())&&u(e.$special())?e.$translate("Cthulhu.critical_special"):u(e.$critical())?e.$translate("Cthulhu.critical"):u(e.$special())?e.$translate("Cthulhu.special"):u(e.$success())?e.$translate("success"):u(e.$broken())&&u(e.$fumble())?e.$translate("Cthulhu.fumble")+"/"+e.$translate("Cthulhu.broken"):u(e.$broken())?e.$translate("Cthulhu.broken"):u(e.$fumble())?e.$translate("Cthulhu.fumble"):u(e.$failure())?e.$translate("failure"):t},0),b(n,"$to_result",function(){return c(l("Result").$new(),"tap",[],function o(m){var C=null==o.$$s?this:o.$$s,s=t;return null==m&&(m=t),s=[C.$success()],c(m,"success=",a(s)),f(s.length,1),s=[C.$failure()],c(m,"failure=",a(s)),f(s.length,1),s=[C.$critical()],c(m,"critical=",a(s)),f(s.length,1),s=[C.$fumble()],c(m,"fumble=",a(s)),s[f(s.length,1)]},{$$arity:1,$$s:this})},0),b(d,"$compare",function($,r,n){var l,_,h=this,e=t;return null==n&&(n=0),l=E("CompareResult").$new(h.locale),_=I(A(r,h.special_percentage),100).$to_i().$clamp(1,100),u(x($,r))&&u(K($,100))?(c(l,"success=",a(e=[!0])),f(e.length,1),e=[x($,_)],c(l,"special=",a(e)),f(e.length,1),e=[x($,h.critical_percentage)],c(l,"critical=",a(e)),f(e.length,1)):(c(l,"failure=",a(e=[!0])),f(e.length,1),e=[D($,f(101,h.fumble_percentage))],c(l,"fumble=",a(e)),f(e.length,1)),u(S(n,0))&&u(D($,n))&&(c(l,"broken=",a(e=[!0])),f(e.length,1),c(l,"failure=",a(e=[!0])),f(e.length,1),c(l,"success=",a(e=[!1])),f(e.length,1),c(l,"special=",a(e=[!1])),f(e.length,1),c(l,"critical=",a(e=[!1])),f(e.length,1)),l},-3),b(d,"$getRegistResult",function($){var r=this,n=t,h=t,l=t,_=t,e=t;return n=/^RESB?(-?\d+)$/i.$match($),u(n)?(h=n["$[]"](1).$to_i(),l=q(A(h,5),50),u(K(l,5))?E("Result").$failure("(1d100<="+l+") \uff1e "+r.$translate("Cthulhu.automatic_failure")):u(S(l,95))?E("Result").$success("(1d100<="+l+") \uff1e "+r.$translate("Cthulhu.automatic_success")):(_=r.randomizer.$roll_once(100),e=r.$compare(_,l),c(e.$to_result(),"tap",[],function(m){var C;return null==m&&(m=t),C=["(1d100<="+l+") \uff1e "+_+" \uff1e "+e.$text()],c(m,"text=",a(C)),C[f(C.length,1)]},1))):t},1),b(d,"$getCombineRoll",function($){var r=this,n=t,h=t,l=t,_=t,e=t,o=t,m=t;return n=/^CBR(B)?\((\d+),(\d+)\)$/i.$match($),u(n)?(h=n["$[]"](2).$to_i(),l=n["$[]"](3).$to_i(),_=r.randomizer.$roll_once(100),e=r.$compare(_,h),o=r.$compare(_,l),m=u(e.$success())&&u(o.$success())?r.$translate("success"):u(e.$success())||u(o.$success())?r.$translate("Cthulhu.partial_success"):r.$translate("failure"),c(E("Result").$new(),"tap",[],function(s){var g=t,w=t;return null==s&&(s=t),g=["(1d100<="+h+","+l+") \uff1e "+_+"["+e.$text()+","+o.$text()+"] \uff1e "+m],c(s,"text=",a(g)),f(g.length,1),g=[u(w=e.$critical())?w:o.$critical()],c(s,"critical=",a(g)),f(g.length,1),g=[u(w=e.$fumble())?w:o.$fumble()],c(s,"fumble=",a(g)),f(g.length,1),g=[u(w=e.$success())?w:o.$success()],c(s,"condition=",a(g)),g[f(g.length,1)]},1)):t},1)})}}]);