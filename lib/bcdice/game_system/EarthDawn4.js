(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[809],{9918:(le,ue,$e)=>{$e(9993),Opal.modules["bcdice/game_system/EarthDawn"]=function(c){var X,O,ne,q,N,z,x,G,ee,U,P=[],l=c.nil,e=c.module,Y=c.klass,F=c.const_set,K=c.send2,W=c.find_super,k=c.def,_=c.truthy,M=c.rb_gt,b=c.rb_lt,S=c.rb_minus,E=c.eqeqeq,i=c.rb_plus,I=c.neqeq,A=c.eqeq,B=c.rb_ge,j=c.send;return X=P,O=U=[e(P[0],"BCDice")].concat(X),G=[e(U[0],"GameSystem")].concat(O),ee=c.$r(G),ne=G,N=[q=Y(G[0],ee("Base"),"EarthDawn")].concat(ne),z=c.$r(N),(x=q.$$prototype).string=x.isFailed=l,F(N[0],"ID","EarthDawn"),F(N[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f3"),F(N[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u3093"),F(N[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEn+k)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9k(D2-D20)\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u632f\u308a\u8db3\u3057\u3082\u81ea\u52d5\u3002\n\u4f8b\uff099E\u300010E8\u300010E+D12\n"),q.$register_prefix("\\d+e"),k(q,"$initialize",function T(m){var r=this;return delete T.$$p,K(r,W(r,"initialize",T,!1,!0),"initialize",[m],null),r.sort_add_dice=!0},1),k(q,"$eval_game_system_specific_command",function(m){return this.$ed_step(m)},1),k(q,"$ed_step",function(m){return this.$getStepResult(m)},1),k(q,"$getStepResult",function(m){var $=this,r=l,s=l,t=l,n=l,a=l,u=l,o=l,d=l,f=l,g=l,p=l,h=l,v=l,y=l,R=l,D=l,H=l,w=l,L=l,se=l;return!_(/(\d+)E(\d+)?(\+)?(\d+)?(d\d+)?/i["$=~"](m))||(r=0,$.isFailed=!0,s=z("Regexp").$last_match(1).$to_i(),t=0,n=!1,a=0,u=0,_(M(s,40))&&(s=40),_(z("Regexp").$last_match(2))&&(t=z("Regexp").$last_match(2).$to_i(),_(M(t,43))&&(t=42)),_(z("Regexp").$last_match(3))&&(n=z("Regexp").$last_match(3).$to_i()),_(z("Regexp").$last_match(4))&&(a=z("Regexp").$last_match(4).$to_i()),_(z("Regexp").$last_match(5))&&(u=z("Regexp").$last_match(5)),_(b(t,0)))?l:(d=(o=$.$getStepTable())["$[]"](0)["$[]"](S(s,1)),f=o["$[]"](1)["$[]"](S(s,1)),g=o["$[]"](2)["$[]"](S(s,1)),p=o["$[]"](3)["$[]"](S(s,1)),h=o["$[]"](4)["$[]"](S(s,1)),v=o["$[]"](5)["$[]"](S(s,1)),y=o["$[]"](6)["$[]"](S(s,1)),_(n)&&(E(/d20/i,R=u)?f=i(f,a):E(/d12/i,R)?g=i(g,a):E(/d10/i,R)?p=i(p,a):E(/d8/i,R)?h=i(h,a):E(/d6/i,R)?v=i(v,a):E(/d4/i,R)?y=i(y,a):d=i(d,a)),$.string="",$.$debug("d20step, d12step, d10step, d8step, d6step, d4step",f,g,p,h,v,y),r=i(r,$.$rollStep(20,f)),r=i(r,$.$rollStep(12,g)),r=i(r,$.$rollStep(10,p)),r=i(r,$.$rollStep(8,h)),r=i(r,$.$rollStep(6,v)),r=i(r,$.$rollStep(4,y)),_(M(d,0))&&($.string=i($.string,"+")),I(d,0)&&($.string=i($.string,d.$to_s()),r=i(r,d)),$.string=i($.string," \uff1e "+r),D="\u30b9\u30c6\u30c3\u30d7"+s+" \uff1e "+$.string,A(t,0)||($.string=i($.string," \uff1e "),H=o["$[]"](7)["$[]"](S(t,1)),w=o["$[]"](8)["$[]"](S(t,1)),L=o["$[]"](9)["$[]"](S(t,1)),se=o["$[]"](11)["$[]"](S(t,1)),$.string=_($.isFailed)?i($.string,"\u81ea\u52d5\u5931\u6557"):_(B(r,H))?i($.string,"\u6700\u826f\u6210\u529f"):_(B(r,w))?i($.string,"\u512a\u6210\u529f"):_(B(r,L))?i($.string,"\u826f\u6210\u529f"):_(B(r,t))?i($.string,"\u6210\u529f"):_(b(r,se))?i($.string,"\u5927\u5931\u6557"):i($.string,"\u5931\u6557"),D="\u30b9\u30c6\u30c3\u30d7"+s+">="+t+" \uff1e "+$.string),D)},1),k(q,"$getStepTable",function(){return[[-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[0,0,0,0,0,1,0,0,0,1,1,2,1,0,0,0,1,0,0,0,1,1,2,1,1,1,1,2,1,1,1,2,3,2,1,1,1,2,1,1,0,0,1,0,0,0,1,0,0,0,1,1,2,1],[0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,1,1,2,1,1,1,2,2,1,1,1,1,2,1,1,1,0,0,1,0,0,1,0,0,0,1,0,1,0,0],[0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,0,0,0,0,1,0,0,0,2,0,0,0,0,1,0,0,0,2,1,1,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[6,8,10,12,14,17,19,20,22,24,25,27,29,32,33,35,37,38,39,41,42,44,45,47,48,49,51,52,54,55,56,58,59,60,62,64,65,67,68,70,71,72],[4,6,8,10,11,13,15,16,18,19,21,22,24,26,27,29,30,32,33,34,35,37,38,40,41,42,43,45,46,47,48,49,51,52,53,55,56,58,59,60,61,62],[2,4,6,7,9,10,12,13,14,15,17,18,20,21,22,24,25,26,27,28,29,31,32,33,34,35,36,38,39,40,41,42,43,45,46,47,48,50,51,52,53,54],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],[0,1,1,1,1,2,2,3,4,5,5,6,6,7,8,8,9,10,11,12,13,13,14,15,16,17,18,18,18,20,21,22,23,23,24,25,26,26,27,28,29,30]]},0),k(q,"$rollStep",function(m,$){var r=this,s=l;return r.$debug("rollStep diceType, diceCount, @string",m,$,r.string),s=0,_(M($,0))&&(_(r.string["$empty?"]())||(r.string=i(r.string,"+")),r.string=i(r.string,$+"d"+m+"["),r.$debug("rollStep @string",r.string),j($,"times",[],function t(n){var u=null==t.$$s?this:t.$$s,o=l,d=l;for(null==u.randomizer&&(u.randomizer=l),null==u.string&&(u.string=l),null==n&&(n=l),o=u.randomizer.$roll_once(m),I(o,1)&&(u.isFailed=!1),d=o;A(o,m);)o=u.randomizer.$roll_once(m),d=i(d,o);return s=i(s,d),I(n,0)&&(u.string=i(u.string,",")),u.string=i(u.string,d.$to_s())},{$$arity:1,$$s:r}),r.string=i(r.string,"]")),s},2)},Opal.queue(function(c){var Z,ee,z,x,T,m,$,C,ne,V,l=[],e=c.nil,Y=c.module,F=c.klass,K=c.const_set,W=c.send2,k=c.find_super,_=c.def,M=c.to_ary,b=c.truthy,S=c.eqeq,E=c.send,i=c.rb_plus,I=c.rb_gt,A=c.rb_lt,B=c.rb_le,j=c.rb_minus,J=c.rb_divide,X=c.to_a,Q=c.neqeq;return c.top.$require("bcdice/game_system/EarthDawn"),Z=l,ee=V=[Y(l[0],"BCDice")].concat(Z),C=[Y(V[0],"GameSystem")].concat(ee),ne=c.$r(C),z=C,T=[x=F(C[0],ne("EarthDawn"),"EarthDawn4")].concat(z),m=c.$r(T),($=x.$$prototype).calcText=$.isFailed=e,K(T[0],"ID","EarthDawn4"),K(T[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f34\u7248"),K(T[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u30934"),K(T[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEnK)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3002\n\u30ab\u30eb\u30de\u30c0\u30a4\u30b9\u4f7f\u7528\u6642\u306f\u672b\u5c3e\u306bK\u3092\u8ffd\u52a0\uff08\u7701\u7565\u53ef\u80fd\uff09\n\u4f8b\uff09\u30b9\u30c6\u30c3\u30d710\uff1a10E\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\uff1a10E8\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9\uff1a10E8K\n"),x.$register_prefix("\\d+e"),_(x,"$initialize",function r(s){var n=this;return delete r.$$p,W(n,k(n,"initialize",r,!1,!0),"initialize",[s],null),n.sort_add_dice=!0,n.calcText=""},1),_(x,"$eval_game_system_specific_command",function(s){return this.$ed_step(s)},1),_(x,"$ed_step",function(s){return this.$getStepResult(s)},1),_(x,"$getStepResult",function(s){var t,n,o,d,f,u=e;return n=this.$getStepResultInfos(s),o=null==(t=M(n))[1]?e:t[1],d=null==t[2]?e:t[2],f=null==t[3]?e:t[3],b((u=null==t[0]?e:t[0])["$nil?"]())?e:S(f,0)?u+" \uff1e "+o+" \uff1e "+d:u+">="+f+" \uff1e "+o+" \uff1e "+d+" \uff1e "+this.$getSuccess(f,d)},1),_(x,"$getStepResultInfos",function(s){var n,a,H,L,u=this,o=e,d=e,f=e,g=e,p=e,h=e,v=e,y=e,R=e,D=e,w=e;for(o=[],d=[],f=[],g=0;b(b(p=s["$nil?"]()["$!"]())?s["$empty?"]()["$!"]():p);){if(u.$debug("=====>!! str",s),a=u.$getStepResultInfo(s),v=null==(n=M(a))[1]?e:n[1],y=null==n[2]?e:n[2],R=null==n[3]?e:n[3],D=null==n[4]?e:n[4],u.$debug("=====> step",h=null==n[0]?e:n[0]),b(h["$nil?"]()))return e;if(o["$<<"](h),d["$<<"](v),f["$<<"](y),S(R,0)||(g=R),u.$debug("=====> nextText",D),S(D,s))break;s=D}return H=o.$join("+"),w=d.$join(")+("),L=E(f,"inject",[],function(re,ie){return null==re&&(re=e),null==ie&&(ie=e),i(re,ie)},2),b(I(d.$size(),1))&&(w=i(i("(",w),")")),b(I(f.$size(),1))&&(w=i(w," \uff1e ("+f.$join("+")+")")),[H,w,L,g]},1),_(x,"$getStepResultInfo",function(s){var t=this,n=e,a=e,u=e,o=e,d=e,f=e,g=e,h=e;return!b(/^(\d+)E(\d+)?(K)?(\+\d+$)?(\+(.*))?/i["$=~"](s))||(n=0,t.isFailed=!0,a=m("Regexp").$last_match(1).$to_i(),u=m("Regexp").$last_match(2).$to_i(),b(A(u,0)))?e:(o=m("Regexp").$last_match(3)["$nil?"]()["$!"](),d=m("Regexp").$last_match(4).$to_i(),f=m("Regexp").$last_match(6),g=t.$getStepInfo(a),t.$debug("stepInfo",g),t.calcText="",E([20,12,10,8,6,4],"each",[],function y(R){return null==R&&(R=e),n=i(n,(null==y.$$s?this:y.$$s).$rollStep(R,g.$shift()))},{$$arity:1,$$s:t}),h=g.$shift(),b(o)&&(n=i(n,t.$rollStep(6,1))),t.calcText=i(t.calcText,i(t.$getModifyText(h),t.$getModifyText(d))),n=i(n,i(h,d)),["\u30b9\u30c6\u30c3\u30d7"+a,t.calcText,n,u,f])},1),_(x,"$getModifyText",function(s){var t=e;return t="",S(s,0)||(b(I(s,0))&&(t=i(t,"+")),t=i(t,s.$to_s())),t},1),_(x,"$getBaseStepTable",function(){return[[1,[0,0,0,0,0,1,-2]],[2,[0,0,0,0,0,1,-1]],[3,[0,0,0,0,0,1,0]],[4,[0,0,0,0,1,0,0]],[5,[0,0,0,1,0,0,0]],[6,[0,0,1,0,0,0,0]],[7,[0,1,0,0,0,0,0]]]},0),_(x,"$getStepInfo",function(s){var a,t=this,n=e,u=e,o=e,d=e,f=e,g=e,p=e,h=e;return a=(n=t.$getBaseStepTable()).$last().$first(),b(B(s,a))?t.$get_table_by_number(s,n):(u=[1,0,0,0,0,0,0],o=j(j(s,a),1),f=[0,0,0,0,0,0,0],g=J(o,(d=[[0,0,0,0,2,0,0],[0,0,0,1,1,0,0],[0,0,0,2,0,0,0],[0,0,1,1,0,0,0],[0,0,2,0,0,0,0],[0,1,1,0,0,0,0],[0,2,0,0,0,0,0],[0,1,0,0,2,0,0],[0,1,0,1,1,0,0],[0,1,0,2,0,0,0],[0,1,1,1,0,0,0]]).$size()).$to_i(),E(g,"times",[],function v(){return(null==v.$$s?this:v.$$s).$addStepToResult(f,u)},{$$arity:0,$$s:t}),p=o["$%"](d.$size()),h=d["$[]"](p),t.$addStepToResult(f,h),f)},1),_(x,"$addStepToResult",function(s,t){return E(s.$size(),"times",[],function(a){var u;return null==a&&(a=e),u=[a,i(s["$[]"](a),t["$[]"](a))],E(s,"[]=",X(u)),u[j(u.length,1)]},1),s},2),_(x,"$getSuccess",function(s,t){var a=e;return b(this.isFailed)?"\u81ea\u52d5\u5931\u6557":(a=j(t,s),this.$debug("diff",a),b(A(a,0))?"\u5931\u6557":"\u6210\u529f \u30ec\u30d9\u30eb\uff1a"+i(J(a,5).$to_i(),1))},2),_(x,"$rollStep",function(s,t){var n=this,a=e;return n.$debug("rollStep diceType, diceCount, @calcText",s,t,n.calcText),a=0,b(I(t,0))&&(b(n.calcText["$empty?"]())||(n.calcText=i(n.calcText,"+")),n.calcText=i(n.calcText,t+"d"+s+"["),n.$debug("rollStep string",n.calcText),E(t,"times",[],function u(o){var f=null==u.$$s?this:u.$$s,g=e,p=e;for(null==f.randomizer&&(f.randomizer=e),null==f.calcText&&(f.calcText=e),null==o&&(o=e),g=f.randomizer.$roll_once(s),Q(g,1)&&(f.isFailed=!1),p=g;S(g,s);)g=f.randomizer.$roll_once(s),p=i(p,g);return a=i(a,p),Q(o,0)&&(f.calcText=i(f.calcText,",")),f.calcText=i(f.calcText,p.$to_s())},{$$arity:1,$$s:n}),n.calcText=i(n.calcText,"]")),a},2)})}}]);